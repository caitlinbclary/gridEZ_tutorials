---
title: "Introduction: gridEZ, an algorithm for generating gridded sampling frames"
author: 
  - name: "Claire Dooley"
    affiliation: "Centre for Advanced Spatial Analysis, University College London"
    email: "c.dooley@ucl.ac.uk"
format: html
editor: visual
suggested-citation: "Dooley, C.A. (2025). gridEZ Tutorial 0 version 1.0"
bibliography: references.bib
---

## Overview

Surveys provide vital information on the state of a population, e.g. health, economics, perceptions. To accurately assess such population characteristics, surveys require a robust survey design including reliable sampling frames from which Primary Sampling Units (PSUs) are selected. In many settings bespoke sampling frames are needed. For example, where standard sampling frames are unsuitable due to survey needs or unavailable due to missing geographic data. To address this problem, we have designed the **`gridEZ`** algorithm that utilizes gridded population data to generate gridded enumeration zones (EZs), which can serve as a robust sampling frame for household surveys.

These tutorials provide all the code needed not only to run `gridEZ` but to prepare input data effectively, review output sampling frames and format outputs suitable for sample selection.

```{r}
#| echo: false
#| label: fig-plot0.1
#| fig-width: 3
#| fig-asp: 1
#| fig-alt: "Example gridEZ sampling frame"
#| fig-cap: "Example gridEZ sampling frame for Samoa. Map imagery: Google, Maxar Technologies Â©2025"

knitr::include_graphics("images/WSM_example_output_medEZ.png")
```

## Recommended prior knowledge

### R software

The **`gridEZ`** algorithm is operationalised through the `gridEZ2` R package. Basic knowledge of R recommended for using `gridEZ`, however, this set of tutorials aims to simplify the process of generating sampling frames - so, even with limited experience using R, you should be able to work through them. If you are new to R or would like to brush up, we recommend the following tutorial [@maclachlan2022], sections 2.4.3 to 2.6: <https://andrewmaclachlan.github.io/CASA0005repo/introduction-to-r.html#r-and-rstudio>

### Geographic data

In the tutorials, we provide step-by-step guidance on preparing, visualizing, and evaluating different forms of geo-referenced data. Therefore, the tutorials are suitable for those with little experience working with geographic data. However, we recommend that you have good knowledge of some key concepts:

-   Coordinate reference systems: <https://docs.qgis.org/3.40/en/docs/gentle_gis_introduction/coordinate_reference_systems.html>

-   Vector data: <https://docs.qgis.org/3.40/en/docs/gentle_gis_introduction/vector_data.html>

-   Raster data: <https://docs.qgis.org/3.40/en/docs/gentle_gis_introduction/raster_data.html>

### Gridded surveys

The goal of `gridEZ` is to generate sampling frames in preparation for gridded surveys. Although no prior knowledge of gridded surveys is needed to complete these tutorials, if you would like to assess whether a gridded survey is suitable for your needs, we recommend that you consult the following manual on Designing and Implementing Gridded Population Surveys [@thomson2022]: <https://gridpopsurvey.com/>

## Installing the gridEZ2 R package

To install the `gridEZ2` R package from github, you will first need the `devtools` R package. As with all R packages, you only need to install it once. All subsequent tutorial chapters assume that `gridEZ2` has been installed.

```{r}
#| eval: false

# install devtools (if you don't already have it installed)
install.packages("devtools")

# install gridEZ2 from GitHub
devtools::install_github("cadooley/gridEZ2")
```

## Input data

Given that many surveys need one or two forms of spatial stratification, e.g. by administrative units and settlement type (urban/rural), we have deisnged the `gridEZ` function to create stratified sampling frames. This means that the geographic units (enumeration zones) within the sampling frame do not span more than one stratum. For a robust survey design, sampling frame EZs should be delinated such that they all have a similar population size (except in regions with very few inhabitants). To generate stratified sampling frames made of EZs with an ideal population size, `gridEZ` requires three input datasets:

-   gridded high-spatial-resolution population counts/estimates

-   strata layer 1

-   strata layer 2

The population counts data should be closely related to the population being surveyed. If you are conducting a survey of people or households, the population counts data should be people or households per grid cell. If your survey is of businesses, the population counts data should be a count of businesses per grid cell.

Throughout the tutorials we use a range of strata examples such as administrative units, settlement type and categories of distance to the nearest coastline (e.g. 0-2km, \>2km). The strata should be carefully selected by considering the goals of the survey. Goals may include whether you would like the survey results to be compared to an existing survey. In this case you may want to use the same stratification as that survey. Another goal might be to compare survey responses between different settings, e.g. rates of water insecurity across different climate zones. If the different settings are large spatially contiguous areas, as climates zones are, then stratifying by setting would be beneficial in achieving target sample sizes in each setting.

Note that the strata layers could simply be a single classification if no stratification is needed.

The input data must be in raster form, each consisting of the same coordinate reference system, spatial resolution and extent. In each tutorial, we give step-by-step guidance in preparing common input rasters from publicly available datasets.

## Parameter selection

The key parameters that need to be defined are:

-   target population size per EZ

-   maximum geographic size per EZ

The target population size per EZ refers to the ideal population size you would like Primary Sampling Units to contain.

The maximum geographic size helps prevent EZs from being too large for field data collection in sparsely populated regions. As the input data are rasters, `gridEZ` considers geographic size in terms of number of grid cells. The spatial resolution of the input data will therefore play a role in deciding how to set this parameter. Note that the maximum geographic size per EZ is not absolute and EZs may be larger than this parameter. `gridEZ` uses this parameter as a guide to decide whether to add/split blocks of grid cells. This decision is weighed against the compactness and population size of the EZs that would result from an add/split operation. In practical terms, the flexibility in the maximum geographic size prevents the sampling frame from including many EZs much smaller than the set maximum geographic size that also have low population counts - two undesirable traits. It is better for an EZ to be slightly larger in geographic size if that helps keep its population closer to the target. If a survey design requires a very strict maximum geographic size of survey units, then the maximum geographic size parameter can be set to approximately two thirds of the strict value.

You can either use pre-defined specifications for these parameters or you can select your own.

### Pre-defined specifications

There are three options: small, medium and large. @tbl-table0.1 reports the target population size per EZ and the target maximum grid cells per EZ used in each option. It also shows the range in population per EZ that `gridEZ` considers acceptable, based on the target population per EZ. In addition, **Table 1** lists the acceptable maximum number of grid cells per EZ, which is set at 1.5 times the target maximum.

```{r}
#| echo: false
#| label: tbl-table0.1
#| tbl-cap: "Pre-defined gridEZ parameters for different sampling frames"

library(knitr) 

df <- data.frame(c("small","medium","large"),
                   c(75,500,1200),
                 c("50-100","333-667","800-1600"),
                   c(100,900,2500),
                 c(150,1350,3750))
colnames(df) <- c("EZ size","Target population size per EZ","Acceptable population range", "Target maximum grid cells per EZ", "Acceptable maximum grid cells per EZ")

knitr::kable(df)
```

To use the pre-defined specifications in the `gridEZ` function, the `predefined_EZ_size` parameter should be set as TRUE and the `EZ_target_size` parameter should be set to either "small", "medium" or "large".

### User-defined specifications

If you would like to define your own target population size per EZ and maximum geographic size per EZ, you should set the `predefined_EZ_size` parameter to be FALSE and then use the `target_pop_per_EZ` and `max_cells_per_EZ` parameter to set the desired values. When `predefined_EZ_size` is set to FALSE, the `EZ_target_size` parameter is ignored.

## Guidance on tutorials

Tutorial 1 provides a comprehensive guide to preparing input data, running `gridEZ`, and evaluating the resulting sampling frame. In this first tutorial, we go into a lot of detail. In the subsequent tutorials, less explanation is given for the data processing steps and output sampling frames not examined to the same extent. Tutorials 2 and beyond present example workflows designed for a range of survey objectives. We strongly recommend that you complete Tutorial 1 before eorking through other tutorials. Once you have Tutorial one in the bag, you can move on to any of the others, i.e. they are not intended to be sequential.

To help you quickly locate relevant tutorials, the table below summarises their key features.

```{r}
#| echo: false
#| label: tbl-table0.2
#| tbl-cap: "Key features of tutorials"

library(knitr) 

df <- data.frame(c(1:3),
                   c("WorldPop 2025 (R2025A version v1)","WorldPop 2025 (R2025A version v1) & GHS-POP 2025 (R2023A)","WorldPop 2025 (R2025A version v1)"),
                 c("Administrative units: GADM (v4.1)","Administrative units: GADM (v4.1)","Administrative units: GADM (v4.1)"),
                 c("Settlement type: GHS-SMOD 2025 (R2023A)","Settlement type: GHS-SMOD 2025 (R2023A)","Distance to coast"),
                   c("large","small, medium, large","large"),
                 c("both","pre-defined","pre-defined"))
colnames(df) <- c("Tutorial","Pop. data","Strata 1","Strata 2","EZ size","Pre/user-defined specs")

knitr::kable(df)
```
