[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Introduction: gridEZ, an algorithm for generating gridded sampling frames",
    "section": "",
    "text": "Household surveys provide vital information on the state of a population, e.g. health, economics, perceptions. To accurately assess such population characteristics, household surveys require a robust survey design including reliable sampling frames from which Primary Sampling Units (PSUs) are selected. In many settings bespoke sampling frames are needed. For example, where standard sampling frames are unsuitable due to survey needs or unavailable due to missing geographic data. To address this problem, we have designed the gridEZ algorithm that utilizes gridded population data to generate gridded enumeration zones (EZs), which can serve as a robust sampling frame for household surveys.\nThese tutorials provide all the code needed not only to run gridEZ but to prepare input data effectively, review output sampling frames and format outputs suitable for sample selection."
  },
  {
    "objectID": "index.html#overview",
    "href": "index.html#overview",
    "title": "Introduction: gridEZ, an algorithm for generating gridded sampling frames",
    "section": "",
    "text": "Household surveys provide vital information on the state of a population, e.g. health, economics, perceptions. To accurately assess such population characteristics, household surveys require a robust survey design including reliable sampling frames from which Primary Sampling Units (PSUs) are selected. In many settings bespoke sampling frames are needed. For example, where standard sampling frames are unsuitable due to survey needs or unavailable due to missing geographic data. To address this problem, we have designed the gridEZ algorithm that utilizes gridded population data to generate gridded enumeration zones (EZs), which can serve as a robust sampling frame for household surveys.\nThese tutorials provide all the code needed not only to run gridEZ but to prepare input data effectively, review output sampling frames and format outputs suitable for sample selection."
  },
  {
    "objectID": "index.html#recommended-prior-knowledge",
    "href": "index.html#recommended-prior-knowledge",
    "title": "Introduction: gridEZ, an algorithm for generating gridded sampling frames",
    "section": "Recommended prior knowledge",
    "text": "Recommended prior knowledge\n\nR software\nThe gridEZ algorithm is operationalised through the gridEZ2 R package. Basic knowledge of R recommended for using gridEZ, however, this set of tutorials aims to simplify the process of generating sampling frames - so, even with limited experience using R, you should be able to work through them. If you are new to R or would like to brush up, we recommend the following tutorial (MacLachlan and Dennett 2022), sections 2.4.3 to 2.6: https://andrewmaclachlan.github.io/CASA0005repo/introduction-to-r.html#r-and-rstudio\n\n\nGeographic data\nIn the tutorials, we provide step-by-step guidance on preparing, visualizing, and evaluating different forms of geo-referenced data. Therefore, the tutorials are suitable for those with little experience working with geographic data. However, we recommend that you have good knowledge of some key concepts:\n\nCoordinate reference systems: https://docs.qgis.org/3.40/en/docs/gentle_gis_introduction/coordinate_reference_systems.html\nVector data: https://docs.qgis.org/3.40/en/docs/gentle_gis_introduction/vector_data.html\nRaster data: https://docs.qgis.org/3.40/en/docs/gentle_gis_introduction/raster_data.html\n\n\n\nGridded surveys\nThe goal of gridEZ is to generate sampling frames in preparation for gridded surveys. Although no prior knowledge of gridded surveys is needed to complete these tutorials, if you would like to assess whether a gridded survey is suitable for your needs, we recommend that you consult the following manual on Designing and Implementing Gridded Population Surveys (Thomson 2022): https://gridpopsurvey.com/"
  },
  {
    "objectID": "index.html#installing-the-gridez2-r-package",
    "href": "index.html#installing-the-gridez2-r-package",
    "title": "Introduction: gridEZ, an algorithm for generating gridded sampling frames",
    "section": "Installing the gridEZ2 R package",
    "text": "Installing the gridEZ2 R package\nTo install the gridEZ2 R package from github, you will first need the devtools R package. As with all R packages, you only need to install it once. All subsequent tutorial chapters assume that gridEZ2 has been installed.\n\n# install devtools (if you don't already have it installed)\ninstall.packages(\"devtools\")\n\n# install gridEZ2 from GitHub\ndevtools::install_github(\"cadooley/gridEZ2\")"
  },
  {
    "objectID": "index.html#input-data",
    "href": "index.html#input-data",
    "title": "Introduction: gridEZ, an algorithm for generating gridded sampling frames",
    "section": "Input data",
    "text": "Input data\nGiven that many surveys need one or two forms of spatial stratification, e.g. by administrative units and settlement type (urban/rural), we have deisnged the gridEZ function to create stratified sampling frames. This means that the geographic units (enumeration zones) within the sampling frame do not span more than one stratum. For a robust survey design, sampling frame EZs should be delinated such that they all have a similar population size (except in regions with very few inhabitants). To generate stratified sampling frames made of EZs with an ideal population size, gridEZ requires three input datasets:\n\ngridded high-spatial-resolution population counts/estimates\nstrata layer 1\nstrata layer 2\n\nThe population counts data should be closely related to the population being surveyed. If you are conducting a survey of people or households, the population counts data should be people or households per grid cell. If your survey is of businesses, the population counts data should be a count of businesses per grid cell.\nThroughout the tutorials we use a range of strata examples such as administrative units, settlement type and categories of distance to the nearest coastline (e.g. 0-2km, &gt;2km). The strata should be carefully selected by considering the goals of the survey. Goals may include whether you would like the survey results to be compared to an existing survey. In this case you may want to use the same stratification as that survey. Another goal might be to compare survey responses between different settings, e.g. rates of water insecurity across different climate zones. If the different settings are large spatially contiguous areas, as climates zones are, then stratifying by setting would be beneficial in achieving target sample sizes in each setting.\nNote that the strata layers could simply be a single classification if no stratification is needed.\nThe input data must be in raster form, each consisting of the same coordinate reference system, spatial resolution and extent. In each tutorial, we give step-by-step guidance in preparing common input rasters from publicly available datasets."
  },
  {
    "objectID": "index.html#parameter-selection",
    "href": "index.html#parameter-selection",
    "title": "Introduction: gridEZ, an algorithm for generating gridded sampling frames",
    "section": "Parameter selection",
    "text": "Parameter selection\nThe key parameters that need to be defined are:\n\ntarget population size per EZ\nmaximum geographic size per EZ\n\nThe target population size per EZ refers to the ideal population size you would like Primary Sampling Units to contain.\nThe maximum geographic size helps prevent EZs from being too large for field data collection in sparsely populated regions. As the input data are rasters, gridEZ considers geographic size in terms of number of grid cells. The spatial resolution of the input data will therefore play a role in deciding how to set this parameter. Note that the maximum geographic size per EZ is not absolute and EZs may be larger than this parameter. gridEZ uses this parameter as a guide to decide whether to add/split blocks of grid cells. This decision is weighed against the compactness and population size of the EZs that would result from an add/split operation. In practical terms, the flexibility in the maximum geographic size prevents the sampling frame from including many EZs much smaller than the set maximum geographic size that also have low population counts - two undesirable traits. It is better for an EZ to be slightly larger in geographic size if that helps keep its population closer to the target. If a survey design requires a very strict maximum geographic size of survey units, then the maximum geographic size parameter can be set to approximately two thirds of the strict value.\nYou can either use pre-defined specifications for these parameters or you can select your own.\n\nPre-defined specifications\nThere are three options: small, medium and large. Table 1 reports the target population size per EZ and the target maximum grid cells per EZ used in each option. It also shows the range in population per EZ that gridEZ considers acceptable, based on the target population per EZ. In addition, Table 1 lists the acceptable maximum number of grid cells per EZ, which is set at 1.5 times the target maximum.\n\n\n\n\nTable 1: Pre-defined gridEZ parameters for different sampling frames\n\n\n\n\n\n\n\n\n\n\n\n\n\nEZ size\nTarget population size per EZ\nAcceptable population range\nTarget maximum grid cells per EZ\nAcceptable maximum grid cells per EZ\n\n\n\n\nsmall\n75\n50-100\n100\n150\n\n\nmedium\n500\n333-667\n900\n1350\n\n\nlarge\n1200\n800-1600\n2500\n3750\n\n\n\n\n\n\n\n\nTo use the pre-defined specifications in the gridEZ function, the predefined_EZ_size parameter should be set as TRUE and the EZ_target_size parameter should be set to either “small”, “medium” or “large”.\n\n\nUser-defined specifications\nIf you would like to define your own target population size per EZ and maximum geographic size per EZ, you should set the predefined_EZ_size parameter to be FALSE and then use the target_pop_per_EZ and max_cells_per_EZ parameter to set the desired values. When predefined_EZ_size is set to FALSE, the EZ_target_size parameter is ignored."
  },
  {
    "objectID": "index.html#guidance-on-tutorials",
    "href": "index.html#guidance-on-tutorials",
    "title": "Introduction: gridEZ, an algorithm for generating gridded sampling frames",
    "section": "Guidance on tutorials",
    "text": "Guidance on tutorials\nTutorial 1 provides a comprehensive guide to preparing input data, running gridEZ, and evaluating the resulting sampling frame. In this first tutorial, we go into a lot of detail. In the subsequent tutorials, less explanation is given for the data processing steps and output sampling frames not examined to the same extent. Tutorials 2 and beyond present example workflows designed for a range of survey objectives. We strongly recommend that you complete Tutorial 1 before eorking through other tutorials. Once you have Tutorial one in the bag, you can move on to any of the others, i.e. they are not intended to be sequential.\nTo help you quickly locate relevant tutorials, the table below summarises their key features.\n\n\n\n\nTable 2: Key features of tutorials\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nTutorial\nPop. data\nStrata 1\nStrata 2\nEZ size\nPre/user-defined specs\n\n\n\n\n1\nWorldPop 2025 (R2025A version v1)\nAdministrative units: GADM (v4.1)\nSettlement type: GHS-SMOD 2025 (R2023A)\nlarge\nboth\n\n\n2\nWorldPop 2025 (R2025A version v1) & GHS-POP 2025 (R2023A)\nAdministrative units: GADM (v4.1)\nSettlement type: GHS-SMOD 2025 (R2023A)\nsmall, medium, large\npre-defined\n\n\n3\nWorldPop 2025 (R2025A version v1)\nAdministrative units: GADM (v4.1)\nDistance to coast\nlarge\npre-defined"
  },
  {
    "objectID": "gridEZ_tutorial2.html",
    "href": "gridEZ_tutorial2.html",
    "title": "Tutorial 2: applying gridEZ to different population datasets",
    "section": "",
    "text": "Suggested citation: Dooley, C.A. (2025). gridEZ Tutorial 2 version 1.0",
    "crumbs": [
      "Tutorial 2: applying gridEZ to different population datasets"
    ]
  },
  {
    "objectID": "gridEZ_tutorial2.html#tutorial-aim",
    "href": "gridEZ_tutorial2.html#tutorial-aim",
    "title": "Tutorial 2: applying gridEZ to different population datasets",
    "section": "Tutorial Aim",
    "text": "Tutorial Aim\nThe aim of this tutorial is to generate and compare bespoke gridded sampling frames for Samoa based on different gridded population datasets. Comparisons will be made for three different target Enumeration Zone (EZ) population sizes.\nIf you are not familiar with the gridEZ function, we recommend that you go through Tutorial 1 first where the outputs and their features are explained in detail.",
    "crumbs": [
      "Tutorial 2: applying gridEZ to different population datasets"
    ]
  },
  {
    "objectID": "gridEZ_tutorial2.html#packages",
    "href": "gridEZ_tutorial2.html#packages",
    "title": "Tutorial 2: applying gridEZ to different population datasets",
    "section": "Packages",
    "text": "Packages\nLoad all the R packages necessary to complete this tutorial. If you have not yet installed the gridEZ2 package, please follow the instructions on the Tutorial Overview page.\n\n# list of required packages\nrequired_packages &lt;- c(\"sf\", \"terra\", \"parallel\", \"data.table\", \"ggplot2\", \"scico\", \"patchwork\")\n\n# install missing packages\ninstall.packages(setdiff(required_packages, installed.packages()[, \"Package\"]))\n\n# load packages\nlibrary(sf)\nlibrary(terra)\nlibrary(data.table)\nlibrary(parallel)\nlibrary(ggplot2)\nlibrary(scico)\n#library(patchwork)\nlibrary(gridEZ2)",
    "crumbs": [
      "Tutorial 2: applying gridEZ to different population datasets"
    ]
  },
  {
    "objectID": "gridEZ_tutorial2.html#datasets",
    "href": "gridEZ_tutorial2.html#datasets",
    "title": "Tutorial 2: applying gridEZ to different population datasets",
    "section": "Datasets",
    "text": "Datasets\nIn this tutorial, we read in datasets from a folder called “data_wsm”. The code below checks whether you have the folder already. If you don’t, the code will create it.\n\n# check your working directory\ngetwd()\n\n# you may need to change your working directory to point to the location where the data_wsm folder sits. Use setwd() to change your working directory if needed\n\n# check whether the data folder already exists - if not, create the folder \nfile_path &lt;- paste0(getwd(),\"/data_wsm/\")\nif (!dir.exists(paste0(file_path))) {\n  dir.create(file_path)\n}\n\n\nPopulation counts data\nWe will use two different datasets fro creating sampling frames: GHS-POP and WorldPop (which we also used in Tutorial 1).\n\nGHS-POP\nWe will use Global Human Settlement Layer Population Grid data (GHS-POP) (Pesaresi et al. 2024). To download the data, go to the GHS-POP website: https://human-settlement.emergency.copernicus.eu/download.php?ds=pop\nFirst, select the following options on the left hand side:\n\nEpoch = 2025\nResolution = 100m\nCoord. system = Mollweide\n\nSecond, hover your cursor over the map until you find Tile ID: R11_C2 (the Tile ID is written under the map). Click the tile to download. Unzip the data and add to the data folder called “data_wsm”.\n\npopghs_raster &lt;- terra::rast(paste0(getwd(),\"/data_wsm/GHS_POP_E2025_GLOBE_R2023A_54009_100_V1_0_R11_C2/GHS_POP_E2025_GLOBE_R2023A_54009_100_V1_0_R11_C2.tif\"))\n\nplot(popghs_raster,main=\"Population distribution of Samoa & wider area (GHS-POP data)\")\n\n\n\n\n\n\n\n\nAs you can see the GHS-POP tile covers a large area. We will crop this data later in the tutorial!\n\n\nWorldPop\nIf you have completed Tutorial 1 skip the rest of this datasets section.\nWe will use WorldPop’s population counts data (Bondarenko M. 2025). This global dataset has spatial resolution of 3 arc (approximately 100m at the equator) and has population constrained to grid cells that contain settlement. We will use the data for Samoa with estimated population counts for 2025 (alpha version: R2025A version v1).\nMore information about the dataset can be found here: https://hub.worldpop.org/geodata/summary?id=76095\nYou can read in the data directly from the WorldPop server or you can download the data via the link above and then read the data into R.\n\n# Option 1: read in directly from WP server\npopwp_raster&lt;- terra::rast(\"https://data.worldpop.org/GIS/Population/Global_2015_2030/R2025A/2025/WSM/v1/100m/constrained/wsm_pop_2025_CN_100m_R2025A_v1.tif\")\n\n\n# Option 2: read in from file after download\npopwp_raster&lt;- terra::rast(paste0(getwd(),\"/data_wsm/wsm_pop_2025_CN_100m_R2025A_v1.tif\"))\n\n\nplot(popwp_raster,main=\"Population distribution of Samoa (WorldPop data)\")\n\n\n\n\n\n\n\n\n\n\n\nSettlement classification data\nWe will use Global Human Settlement Layer Settlement Model data (GHS-SMOD) (Pesaresi et al. 2024; Schiavina, Melchiorri, and Pesaresi 2023). To download the data, go to the GHS-SMOD website: https://human-settlement.emergency.copernicus.eu/download.php?ds=smod\nFirst, select the following options on the left hand side:\n\nEpoch = 2025\nResolution = 1km\nCoord. system = Mollweide\n\nSecond, hover your cursor over the map until you find Tile ID: R11_C2 (the Tile ID is written under the map). Click the tile to download. Unzip the data and add to the data folder called “data_wsm”.\n\nsettlement_raster &lt;- terra::rast(paste0(getwd(),\"/data_wsm/GHS_SMOD_E2025_GLOBE_R2023A_54009_1000_V2_0_R11_C2/GHS_SMOD_E2025_GLOBE_R2023A_54009_1000_V2_0_R11_C2.tif\"))\n\nplot(settlement_raster,main=\"Settlement categories of Samoa & wider area (GHS-SMOD data)\")\n\n\n\n\n\n\n\n\nThe GHS-SMOD tile covers the same area as the GHS-POP. We will crop both datasets in the Data Processing section.\n\n\nAdministrative Unit Boundaries\nFor the administrative boundaries, we’ll use GADM as it has global coverage and has fully harmonized boundaries (GADM 2022). Download GADM boundaries here by selecting Samoa from the drop down and then clicking “Shapefile”: https://gadm.org/download_country.html\nWe use version 4.1 of the GADM data. If you prefer to use a different version, you can simply edit the file name in the sf::st_read code below. Unzip and add the shapefile to your data_wsm folder.\nRead in level 2 administrative units.\n\nadmin_sf &lt;- sf::st_read(paste0(getwd(),\"/data_WSM/gadm41_WSM_shp/gadm41_WSM_2.shp\"))\n\nReading layer `gadm41_WSM_2' from data source \n  `/Users/clairedooley/Documents/Research/gridEZ/gridEZ_tutorials/data_wsm/gadm41_WSM_shp/gadm41_WSM_2.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 43 features and 13 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -172.8041 ymin: -14.07722 xmax: -171.3977 ymax: -13.43981\nGeodetic CRS:  WGS 84\n\n# look at the list of fields in admin_sf\nnames(admin_sf)\n\n [1] \"GID_2\"     \"GID_0\"     \"COUNTRY\"   \"GID_1\"     \"NAME_1\"    \"NL_NAME_1\"\n [7] \"NAME_2\"    \"VARNAME_2\" \"NL_NAME_2\" \"TYPE_2\"    \"ENGTYPE_2\" \"CC_2\"     \n[13] \"HASC_2\"    \"geometry\" \n\n# plot the \"GID_2\" field which contains the level 2 unit IDs\nplot(admin_sf[\"GID_2\"],main=\"Level 2 administrative units for Samoa (GADM data)\")",
    "crumbs": [
      "Tutorial 2: applying gridEZ to different population datasets"
    ]
  },
  {
    "objectID": "gridEZ_tutorial2.html#data-processing",
    "href": "gridEZ_tutorial2.html#data-processing",
    "title": "Tutorial 2: applying gridEZ to different population datasets",
    "section": "Data Processing",
    "text": "Data Processing\nThe two population datasets are in different coordinate reference systems (CRS). To preserve the original population estimates in each dataset, we’ll prepare two sets of gridEZ input files - one for each CRS.\nBefore doing so, however, there is a processing step common to both sets of inputs so we can do that first.\nIn Tutorial 1, we briefly discussed the GHS-SMOD settlement categories. As there are often single grid cells of one category surrounded by cells of other categories - an undesirable situation when defining sampling frame strata - we merge the categories into just two. If you would like more details on this, you can look back at Tutorial 1. Here, we will go ahead with the re-categorization into one urban category and one rural category.\n\n# re-define categories\nsettlement_raster[settlement_raster %in% c(30,23,22,21)] &lt;- 1 # urban\nsettlement_raster[settlement_raster %in% c(13,12,11)] &lt;- 2 # rural\nsettlement_raster[settlement_raster == 10] &lt;- NA #water\n\n\nPreparation of input files for GHS-POP based sampling frames\nWe already know that the GHS-POP and GHS-SMOD data are in a Mollweide CRS as we selected this when downloading. As we need all input data to be in the same CRS, the next step is to check and, if needed, transform the CRS of the administrative units data.\nTo distinguish between our two sets of input data, we’ll add MW to the names of object we create in a Mollweide CRS.\n\n# change name of pop raster\npopghsMW_raster &lt;- popghs_raster\nrm(popghs_raster)\n\n# identify the CRS of the population raster\nr_crs &lt;- terra::crs(popghsMW_raster)\n\n# if the admin layer is in a different CRS, transform\nif(r_crs !=sf::st_crs(admin_sf)){adminMW_sf &lt;- sf::st_transform(admin_sf, r_crs)}\n\n# re-plot the admin boundaries in their new crs\nplot(adminMW_sf[\"GID_2\"],main=\"Level 2 administrative units for Samoa (GADM data)\")\nmtext(\"CRS = Mollweide\",side=3,line=1)\n\n\n\n\n\n\n\n\nNow, let’s crop the GHS-POP and GHS-SMOD data to include just Samoa.\n\n# crop \n\n# we need to obtain a \"SpatExtent\" object containing our desired extent for this\nadminMW_vect &lt;- vect(adminMW_sf)      # convert sf to SpatVector\nadminMW_ext &lt;- ext(adminMW_vect)      # extract SpatExtent\n# use the \"SpatExtent\" to crop GHS-POP & GHS-SMOD\npopghsMW_raster &lt;- terra::crop(popghsMW_raster,adminMW_ext,snap=\"out\",extend=TRUE)\nsettMW_raster &lt;- terra::crop(settlement_raster,adminMW_ext,snap=\"out\",extend=TRUE)\n\n# plot the pop raster to check the new extent\nplot(popghsMW_raster,main=\"Population distribution of Samoa (GHS-POP data)\")\n\n\n\n\n\n\n\n\nGreat - we have cropped the population and settlement layers to the correct area. From the map, it looks like there may be some buffering around the island landmasses with non-NA population values. This is fine as gridEZ only creates EZs where (non-NA) values for population and both strata exist. So as long as we have non-NA values everywhere inside our administrative unit boundaries and NAs values outside for at least one dataset, we know that EZs will not be constructed outside the national border.\nTo do this, we can create a rasterized version of the administrative units with each grid cell value reflecting the level 2 administrative unit they fall within. We rasterize the administrative units based on the grid of the population raster.\n\n# rasterize admin_sf \nadminMW_raster &lt;- terra::rasterize(adminMW_sf,popghsMW_raster,field=\"GID_2\")\n\n# remove admin_sf object as we no long need it\nrm(adminMW_sf)\n\nThe last step needed before we can save this set of input rasters is to increase the spatial resolution of the settlement raster to match the population and administrative unit rasters. We do this using the terra::resample function.\n\nsettMW_raster &lt;- terra::resample(settMW_raster, popghsMW_raster, method = \"near\")\n\nFinally, save the three rasters into a folder called “made” inside your “data_wsm” folder.\n\n# check whether the \"made\" folder already exists - if not, create the folder \nfile_path &lt;- paste0(getwd(),\"/data_wsm/made/\")\nif (!dir.exists(paste0(file_path))) {\n  dir.create(file_path)\n}\n# save rasters\nterra::writeRaster(adminMW_raster,paste0(file_path,\"adminMW.tif\"))\nterra::writeRaster(popghsMW_raster,paste0(file_path,\"popghsMW.tif\"))\nterra::writeRaster(settMW_raster,paste0(file_path,\"settMW.tif\"))\n\n\n\nPreparation of input files for WorldPop based sampling frames\nAs above, the first processing step is to get all datasets in the same CRS. To preserve the quality of the population estimates we do not want to reproject the population raster. Instead we check and, where needed, transform the other two datasets.\nLet’s check the CRS of the population data first.\n\n# identify the CRS of the population raster\nr_crs &lt;- terra::crs(popwp_raster)\nr_crs # print out the crs\n\n[1] \"GEOGCRS[\\\"WGS 84\\\",\\n    ENSEMBLE[\\\"World Geodetic System 1984 ensemble\\\",\\n        MEMBER[\\\"World Geodetic System 1984 (Transit)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G730)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G873)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G1150)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G1674)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G1762)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G2139)\\\"],\\n        MEMBER[\\\"World Geodetic System 1984 (G2296)\\\"],\\n        ELLIPSOID[\\\"WGS 84\\\",6378137,298.257223563,\\n            LENGTHUNIT[\\\"metre\\\",1]],\\n        ENSEMBLEACCURACY[2.0]],\\n    PRIMEM[\\\"Greenwich\\\",0,\\n        ANGLEUNIT[\\\"degree\\\",0.0174532925199433]],\\n    CS[ellipsoidal,2],\\n        AXIS[\\\"geodetic latitude (Lat)\\\",north,\\n            ORDER[1],\\n            ANGLEUNIT[\\\"degree\\\",0.0174532925199433]],\\n        AXIS[\\\"geodetic longitude (Lon)\\\",east,\\n            ORDER[2],\\n            ANGLEUNIT[\\\"degree\\\",0.0174532925199433]],\\n    USAGE[\\n        SCOPE[\\\"Horizontal component of 3D system.\\\"],\\n        AREA[\\\"World.\\\"],\\n        BBOX[-90,-180,90,180]],\\n    ID[\\\"EPSG\\\",4326]]\"\n\n\nThe WorldPop population data are in a World Geodetic System 1984 projection. We can include “WGS” in the names of data objects to distinguish from the previous objects we created that were in a Mollweide project. OK, let’s go ahead and get all our data in the same CRS.\n\n# change name of pop raster to indicate its crs\npopwpWGS_raster &lt;- popwp_raster\nrm(popwp_raster)\n\n# if the other layers have a different CRS, transform\nif(r_crs !=sf::st_crs(admin_sf)){adminWGS_sf &lt;- sf::st_transform(admin_sf, r_crs)}\nif(r_crs !=terra::crs(settlement_raster)){settWGS_raster &lt;- terra::project(settlement_raster,terra::crs(popwpWGS_raster),method=\"near\")}\n\nNext, we need to convert the sf object containing administrative units into a raster. We do this using the grid of the population raster.\n\n# rasterize admin_sf\nadminWGS_raster &lt;- terra::rasterize(adminWGS_sf,popwpWGS_raster,field=\"GID_2\")\n\n# remove admin_sf object as we no long need it\nrm(adminWGS_sf)\n\nIn this tutorial, we want to generate sampling frames the cover the whole area of Samoa. As the gridEZ function will include all grid cells that have non-NA values across the input datasets, we convert all NA population values inside the national boundary with 0s.\nIf you are interested in creating sampling frames for areas constrained to settlements, please check out Tutorial X.\n\n# replace grid cells of NA population counts that also have non-NA administrative unit values with 0 counts\npopwpWGS_raster[is.na(popwpWGS_raster)&!is.na(adminWGS_raster)] &lt;- 0\n\nNext, we crop the settlement raster to the extent of the administrative units and population rasters.\n\n# crop \nsettWGS_raster &lt;- terra::crop(settWGS_raster,adminWGS_raster,snap=\"out\",extend=TRUE)\n\nNow we have all three rasters in the same CRS and with the same extents.\nFinally, we increase the spatial resolution of the settlement raster to match the population and administrative unit rasters.\n\nsettWGS_raster &lt;- terra::resample(settWGS_raster, popwpWGS_raster, method = \"near\")\n\nWe are ready to save our rasters!\n\n# save rasters\nterra::writeRaster(adminWGS_raster,paste0(file_path,\"adminWGS.tif\"))\nterra::writeRaster(popwpWGS_raster,paste0(file_path,\"popwpWGS.tif\"))\nterra::writeRaster(settWGS_raster,paste0(file_path,\"settWGS.tif\"))",
    "crumbs": [
      "Tutorial 2: applying gridEZ to different population datasets"
    ]
  },
  {
    "objectID": "gridEZ_tutorial2.html#gridez-sampling-frame-generation",
    "href": "gridEZ_tutorial2.html#gridez-sampling-frame-generation",
    "title": "Tutorial 2: applying gridEZ to different population datasets",
    "section": "gridEZ: sampling frame generation",
    "text": "gridEZ: sampling frame generation\nWe will create three sampling frames for each population dataset - one with small EZs, one with medium EZs and one with large EZs.\ngridEZ utilises parallel processing to generate EZs for different strata at the same time. You can set the number of parallel jobs you would like to run using the following code.\n\n# remove all objects\nrm()\n# garbage collection\ngc()\n\n          used (Mb) gc trigger  (Mb) limit (Mb) max used (Mb)\nNcells 1671734 89.3    3112107 166.3         NA  3107715  166\nVcells 2494292 19.1    8388608  64.0      36864  8388604   64\n\n# total number of cores available on your computer\nparallel::detectCores() \n\n[1] 14\n\n# we advise that you use your total number of cores minus 1 but you could use fewer (unless you only acces to one core, then you should specify 1 processing core) \nprocessing_cores &lt;- max(parallel::detectCores() - 1, 1)\nprocessing_cores\n\n[1] 13\n\n\nNext set the file pathways for input and output files.\n\n# input\nfile_path_inputs &lt;- paste0(getwd(),\"/data_wsm/made/\")\n\n# output\n# check whether the output folder already exists - if not, create the folder \nfile_path_outputs_tuts &lt;- paste0(getwd(),\"/results_wsm/\")\nif (!dir.exists(paste0(file_path_outputs_tuts))) {\n  dir.create(file_path_outputs_tuts)\n}\nfile_path_outputs &lt;- paste0(getwd(),\"/results_wsm/tutorial2/\")\nif (!dir.exists(paste0(file_path_outputs))) {\n  dir.create(file_path_outputs)\n}\n\nNow we can create our sampling frames. We’ll change run_ID for each new run of the gridEZ function. Each run may take a minute or so depending on your computing system.\n\n# GHS-POP pop ests, small EZs\ngridEZ2::gridEZ(population_raster_path = paste0(file_path_inputs,\"popghsMW.tif\"), \n                strata1_raster_path = paste0(file_path_inputs,\"adminMW.tif\"), \n                strata2_raster_path = paste0(file_path_inputs,\"settMW.tif\"),\n                predefined_EZ_size = TRUE, \n                EZ_target_size = \"small\",\n                output_path = paste0(file_path_outputs), \n                run_ID = \"wsm_ghs_small\",\n                ncores=processing_cores)\n\n# GHS-POP pop ests, medium EZs\ngridEZ2::gridEZ(population_raster_path = paste0(file_path_inputs,\"popghsMW.tif\"), \n                strata1_raster_path = paste0(file_path_inputs,\"adminMW.tif\"), \n                strata2_raster_path = paste0(file_path_inputs,\"settMW.tif\"),\n                predefined_EZ_size = TRUE, \n                EZ_target_size = \"medium\",\n                output_path = paste0(file_path_outputs), \n                run_ID = \"wsm_ghs_med\",\n                ncores=processing_cores)\n\n# GHS-POP pop ests, large EZs\ngridEZ2::gridEZ(population_raster_path = paste0(file_path_inputs,\"popghsMW.tif\"), \n                strata1_raster_path = paste0(file_path_inputs,\"adminMW.tif\"), \n                strata2_raster_path = paste0(file_path_inputs,\"settMW.tif\"),\n                predefined_EZ_size = TRUE, \n                EZ_target_size = \"large\",\n                output_path = paste0(file_path_outputs), \n                run_ID = \"wsm_ghs_large\",\n                ncores=processing_cores)\n\n# WP pop ests, small EZs\ngridEZ2::gridEZ(population_raster_path = paste0(file_path_inputs,\"popwpWGS.tif\"), \n                strata1_raster_path = paste0(file_path_inputs,\"adminWGS.tif\"), \n                strata2_raster_path = paste0(file_path_inputs,\"settWGS.tif\"),\n                predefined_EZ_size = TRUE, \n                EZ_target_size = \"small\",\n                output_path = paste0(file_path_outputs), \n                run_ID = \"wsm_wp_small\",\n                ncores=processing_cores)\n\n# WP pop ests, medium EZs\ngridEZ2::gridEZ(population_raster_path = paste0(file_path_inputs,\"popwpWGS.tif\"), \n                strata1_raster_path = paste0(file_path_inputs,\"adminWGS.tif\"), \n                strata2_raster_path = paste0(file_path_inputs,\"settWGS.tif\"),\n                predefined_EZ_size = TRUE, \n                EZ_target_size = \"medium\",\n                output_path = paste0(file_path_outputs), \n                run_ID = \"wsm_wp_med\",\n                ncores=processing_cores)\n\n# WP pop ests, large EZs\ngridEZ2::gridEZ(population_raster_path = paste0(file_path_inputs,\"popwpWGS.tif\"), \n                strata1_raster_path = paste0(file_path_inputs,\"adminWGS.tif\"), \n                strata2_raster_path = paste0(file_path_inputs,\"settWGS.tif\"),\n                predefined_EZ_size = TRUE, \n                EZ_target_size = \"large\",\n                output_path = paste0(file_path_outputs), \n                run_ID = \"wsm_wp_large\",\n                ncores=processing_cores)\n\nGreat - now we can look at the results!",
    "crumbs": [
      "Tutorial 2: applying gridEZ to different population datasets"
    ]
  },
  {
    "objectID": "gridEZ_tutorial2.html#results",
    "href": "gridEZ_tutorial2.html#results",
    "title": "Tutorial 2: applying gridEZ to different population datasets",
    "section": "Results",
    "text": "Results\nThe gridEZ function produces two output files:\n\n.csv with file name beginning “EZ_Pop_Ncells_”. Tabular results for EZs within the sampling frame.\n.tif (raster) with file name beginning “EZ_IDs_”. Raster of the sampling frame.\n\nOne way to evaluate gridEZ sampling frames is to categorize EZs based on how well their population and geographic size meet the sampling frame criteria. All the information we need to do this is reported in the .csv file. We also convert the raster into polygons so that we can easily map out the EZ categorizations. The categories we use:\n\nCategory 1: within ideal population range and not geographically too large\nCategory 2: low population but within the maximum geographic size range for sparsely populated areas\nCategory 3: single cell EZ with high population\nCategory 4: high population, contains more than 1 cell but does not exceed the acceptable maximum geographic size\nCategory 5: population and geographic size are too low\nCategory 6: exceeds the acceptable maximum geographic size\n\nCategory 1 includes EZs with ideal characteristics (within the gridded data framework). Categories 2 and 3 contain EZs with acceptable characteristics given the population distribution. Categories 4, 5 and 6 include EZs with undesirable characteristics due to:\n\nlandscape restrictions, e.g. tiny islands (category 5)\ndata restrictions, e.g. stratum contains tiny area (category 5)\ntrade off between compactness and size of EZ (categories 4-6)\n\nFurther explanation and examples for these categories can be found in Tutorial 1.\nOK - let’s evaluates the 6 sampling frames we have generated in this tutorial. First, we need to create a table with the threshold values based on the criteria applied to generate our sampling frames.\n\n# table of threshold values for diff. size EZs\nthresholds_tab &lt;- data.table::data.table( popdata=rep(c(\"wp\",\"ghs\"),each=3), EZsize=rep(c(\"small\",\"med\",\"large\"),2), minpop=rep(c(50,333,800),2), maxpop=rep(c(100,667,1600),2), lowermaxgeog=rep(c(75,675,1875),2), uppermaxgeog=rep(c(150,1350,3750),2) )\nthresholds_tab\n\n   popdata EZsize minpop maxpop lowermaxgeog uppermaxgeog\n    &lt;char&gt; &lt;char&gt;  &lt;num&gt;  &lt;num&gt;        &lt;num&gt;        &lt;num&gt;\n1:      wp  small     50    100           75          150\n2:      wp    med    333    667          675         1350\n3:      wp  large    800   1600         1875         3750\n4:     ghs  small     50    100           75          150\n5:     ghs    med    333    667          675         1350\n6:     ghs  large    800   1600         1875         3750\n\n\nThe next section of code categorizes each EZ in each of our sampling frames and then creates a summary table of the results.\n\n# list of all files in output folder\nfile_list &lt;- list.files(paste0(file_path_outputs),full.names = TRUE) \n# subset to outputs saved above\nfile_list &lt;- file_list[grepl(\"wsm_wp|wsm_ghs\", file_list)] \n\n# categorise EZs based on their pop & geog\nres_poly_list &lt;- lapply(split(thresholds_tab, seq_len(nrow(thresholds_tab))),function(x){\n  # read in summary table of sampling frame\n  file_name &lt;- file_list[grepl(paste(x$popdata), file_list) & grepl(paste(x$EZsize), file_list) & grepl(\"\\\\.csv$\", file_list)]\n  EZ_tab &lt;- read.csv(paste(file_name),header=T)\n  # read in sampling frame raster\n  file_name &lt;- file_list[grepl(paste(x$popdata), file_list) & grepl(paste(x$EZsize), file_list) & grepl(\"\\\\.tif$\", file_list)]\n  EZ &lt;- terra::rast(paste(file_name))\n  # convert to sf polygons\n  res_poly &lt;- terra::as.polygons(EZ, dissolve = TRUE)\n  res_poly &lt;- sf::st_as_sf(res_poly)\n  res_poly &lt;- merge(res_poly,EZ_tab,by=\"EZ_ID\")\n  res_poly$popdata &lt;- x$popdata\n  res_poly$EZsize &lt;- x$EZsize\n  res_poly$cat &lt;- NA\n  res_poly$cat[res_poly$N&lt;=x$uppermaxgeog & res_poly$pop&gt;=x$minpop & res_poly$pop&lt;=x$maxpop] &lt;- 1\n  res_poly$cat[res_poly$N&gt;=x$lowermaxgeog & res_poly$N&lt;=x$uppermaxgeog & res_poly$pop&lt;x$minpop] &lt;- 2\n  res_poly$cat[res_poly$N==1 & res_poly$pop&gt;x$maxpop] &lt;- 3\n  res_poly$cat[res_poly$N&gt;1 & res_poly$pop&gt;x$maxpop] &lt;- 4\n  res_poly$cat[res_poly$N&lt;x$lowermaxgeog & res_poly$pop&lt;x$minpop] &lt;- 5\n  res_poly$cat[res_poly$N&gt;x$uppermaxgeog] &lt;- 6\n  res_poly\n})\n\n# count occurrences of each category value, filling missing cats with zeros\nall_cats &lt;- 1:6\ncount_list &lt;- lapply(res_poly_list, function(res_poly) {\n  counts &lt;- res_poly %&gt;%\n    sf::st_drop_geometry() %&gt;%\n    dplyr::count(cat)\n    # Convert to named vector, fill in missing cats with 0\n    count_vec &lt;- setNames(counts$n, counts$cat)\n    full_vec &lt;- setNames(rep(0, length(all_cats)), all_cats)\n    full_vec[names(count_vec)] &lt;- count_vec\n    prop_vec &lt;- round((full_vec/sum(full_vec))*100,1)\n    names(prop_vec) &lt;- paste0(\"perc\", all_cats)\n    data.table::data.table(popdata=res_poly$popdata[1],EZsize=res_poly$EZsize[1],nEZ=sum(full_vec),t(full_vec),t(prop_vec))\n})\n\n# rbind above count_list object into a table\nsummary_tab &lt;- do.call(rbind, count_list)\n\nThe summary table contains both counts of EZs in each category as well as percentages of EZs in each category, for each sampling frame. Let’s look at the counts first.\n\nnames(summary_tab) # use to know which columns to select in next line\n\n [1] \"popdata\" \"EZsize\"  \"nEZ\"     \"1\"       \"2\"       \"3\"       \"4\"      \n [8] \"5\"       \"6\"       \"perc1\"   \"perc2\"   \"perc3\"   \"perc4\"   \"perc5\"  \n[15] \"perc6\"  \n\nsummary_tab[,1:9] # counts of EZs\n\n   popdata EZsize   nEZ     1     2     3     4     5     6\n    &lt;char&gt; &lt;char&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;\n1:      wp  small  5760  2597  2721     0   113   329     0\n2:      wp    med   743   421   256     0    13    52     1\n3:      wp  large   305   169    83     0     5    48     0\n4:     ghs  small  5452  2317  2275    24   283   552     1\n5:     ghs    med   741   433   220     0    13    73     2\n6:     ghs  large   322   187    64     0     1    70     0\n\n\nNow, percentages.\n\nsummary_tab[,c(1:3,10:15)] # percentage of EZs\n\n   popdata EZsize   nEZ perc1 perc2 perc3 perc4 perc5 perc6\n    &lt;char&gt; &lt;char&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;\n1:      wp  small  5760  45.1  47.2   0.0   2.0   5.7   0.0\n2:      wp    med   743  56.7  34.5   0.0   1.7   7.0   0.1\n3:      wp  large   305  55.4  27.2   0.0   1.6  15.7   0.0\n4:     ghs  small  5452  42.5  41.7   0.4   5.2  10.1   0.0\n5:     ghs    med   741  58.4  29.7   0.0   1.8   9.9   0.3\n6:     ghs  large   322  58.1  19.9   0.0   0.3  21.7   0.0\n\n\nAcross all sampling frames, the majory of EZs fall into categories 1 and 2. The number of EZs falling within category 3 (single cell, high population EZs) is really dependent on population density versus the target population per EZ criterion. In countries with lots of very densely populated areas, we would expect to see lots of EZs in category 3. The only sampling frame containing category 3 EZs in our set of 6, is the one based on GHS-POP with “small” EZ criteria. The results in our summary table tell us that there are 24 GHS-POP grid cells with population counts over 100 people.\nThere are relatively few EZs falling into category 4 (multi-single cell, high population EZs) and very rarely EZs falling into category 6 (exceeding the acceptable geographic maximum). Category 5 EZs (small in terms of both population and geographic size) occur between 5.7 and 21.7% across the 6 sampling frames.\nLet’s map the two “large” EZ sampling frames, colour coded by EZ category.\n\n# map a couple of example outputs\n\n# define the colour coding first\ncat_cols &lt;- scales::hue_pal()(6)\n# plot \nfor(i in c(3,6)){\n  example_EZs &lt;- res_poly_list[[i]]\n  example_EZs$cat &lt;- as.factor(example_EZs$cat)\n  plot(example_EZs[\"cat\"], pal = cat_cols, main=paste(\"EZs by evaluation category (\",example_EZs$popdata[1],\"; \",example_EZs$EZsize[1],\" EZs)\",sep=\"\"))\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nYou can see that EZs across the two sampling frame show a number of similarities in terms of size, shape and category for many locations. The main obvious difference is the angle of many EZs’ boundaries and this comes from the CRS of the administrative boundaries differing.\nThe selection of administrative boundaries and settlement data will have a huge impact on the sampling frame produced by gridEZ as the algorithm assumes the boundaries between classifications (along grid lines) of these two input datasets is true and does not amend them under any circumstances.\nNote that our categorization of EZs is purely to summarise the sampling frames and demonstrate that gridEZ is suitable for producing frames based on either population dataset. A quantitative comparison of EZ categories between sampling frames based on WorldPop data and those based on GHS-POP data does not tell you which is the better sampling frame to use. This is because to date there is no validation of the datasets against real, fine-scale enumeration which means that the quality of EZs in gridEZ sampling frames can not be validated either. Here, we simply evaluate how well the resulting sampling frames match up to our aim (set out by the criteria) given the input data.",
    "crumbs": [
      "Tutorial 2: applying gridEZ to different population datasets"
    ]
  },
  {
    "objectID": "gridEZ_tutorial2.html#summary",
    "href": "gridEZ_tutorial2.html#summary",
    "title": "Tutorial 2: applying gridEZ to different population datasets",
    "section": "Summary",
    "text": "Summary\nThis tutorial has covered:\n\npreparing common datasets suitable for the gridEZ R function\ngenerating gridded sampling frames using WorldPop and GHS-POP gridded population estimates\nsummarizing output sampling frames in terms of the population and geographic size of their constituent EZs\nevaluating sampling frame EZs",
    "crumbs": [
      "Tutorial 2: applying gridEZ to different population datasets"
    ]
  },
  {
    "objectID": "gridEZ_tutorial1.html",
    "href": "gridEZ_tutorial1.html",
    "title": "Tutorial 1: detailed gridEZ example",
    "section": "",
    "text": "Suggested citation: Dooley, C.A. (2025). gridEZ Tutorial 1 version 1.0",
    "crumbs": [
      "Tutorial 1: detailed gridEZ example"
    ]
  },
  {
    "objectID": "gridEZ_tutorial1.html#tutorial-aim",
    "href": "gridEZ_tutorial1.html#tutorial-aim",
    "title": "Tutorial 1: detailed gridEZ example",
    "section": "Tutorial Aim",
    "text": "Tutorial Aim\nThe aim of this tutorial is to generate and evaluate a bespoke gridded sampling frame for Samoa based on gridded population data, gridded settlement data and administrative unit boundaries. The gridded sampling frame will contain gridded Enumeration Zones (EZs) that can be used for sampling survey units.",
    "crumbs": [
      "Tutorial 1: detailed gridEZ example"
    ]
  },
  {
    "objectID": "gridEZ_tutorial1.html#packages",
    "href": "gridEZ_tutorial1.html#packages",
    "title": "Tutorial 1: detailed gridEZ example",
    "section": "Packages",
    "text": "Packages\nThroughout this tutorial we use several different R packages. The following code loads all the packages you will need. If you have not yet installed the gridEZ2 package, please follow the instructions on the Tutorial Overview page.\n\n# list of required packages\nrequired_packages &lt;- c(\"sf\", \"terra\", \"parallel\", \"data.table\", \"ggplot2\", \"scico\", \"patchwork\")\n\n# install missing packages\ninstall.packages(setdiff(required_packages, installed.packages()[, \"Package\"]))\n\n# load packages\nlibrary(sf)\nlibrary(terra)\nlibrary(data.table)\nlibrary(parallel)\nlibrary(ggplot2)\nlibrary(scico)\nlibrary(patchwork)\nlibrary(gridEZ2)",
    "crumbs": [
      "Tutorial 1: detailed gridEZ example"
    ]
  },
  {
    "objectID": "gridEZ_tutorial1.html#datasets",
    "href": "gridEZ_tutorial1.html#datasets",
    "title": "Tutorial 1: detailed gridEZ example",
    "section": "Datasets",
    "text": "Datasets\nBefore we start with the datasets, create a folder for them.\n\n# check your working directory\ngetwd()\n\n# you may need to change your working directory to point to the location where the data_wsm folder sits. Use setwd() to change your working directory if needed\n\n# check whether the data folder already exists - if not, create the folder \nfile_path &lt;- paste0(getwd(),\"/data_wsm/\")\nif (!dir.exists(paste0(file_path))) {\n  dir.create(file_path)\n}\n\n\nPopulation counts data\nFor tutorial 1, we will use WorldPop’s population counts data (Bondarenko M. 2025). This global dataset has spatial resolution of 3 arc (approximately 100m at the equator) and has population constrained to grid cells that contain settlement. We will use the data for Samoa with estimated population counts for 2025 (alpha version: R2025A version v1).\nMore information about the dataset can be found here: https://hub.worldpop.org/geodata/summary?id=76095\nYou can read in the data directly from the WorldPop server or you can download the data via the link above and then read the data into R.\n\n# Option 1: read in directly from WP server\npopulation_raster &lt;- terra::rast(\"https://data.worldpop.org/GIS/Population/Global_2015_2030/R2025A/2025/WSM/v1/100m/constrained/wsm_pop_2025_CN_100m_R2025A_v1.tif\")\n\n\n# Option 2: read in from file after download\npopulation_raster &lt;- terra::rast(paste0(getwd(),\"/data_wsm/wsm_pop_2025_CN_100m_R2025A_v1.tif\"))\n\n\nplot(population_raster,main=\"Population distribution of Samoa (WorldPop data)\")\n\n\n\n\n\n\n\n\n\n\nSettlement classification data\nWe will use Global Human Settlement Layer Settlement Model data (GHS-SMOD) (Pesaresi et al. 2024; Schiavina, Melchiorri, and Pesaresi 2023). To download the data, go to the GHS-SMOD website: https://human-settlement.emergency.copernicus.eu/download.php?ds=smod\nFirst, select the following options on the left hand side:\n\nEpoch = 2025\nResolution = 1km\nCoord. system = Mollweide\n\nSecond, hover your cursor over the map until you find Tile ID: R11_C2 (the Tile ID is written under the map). Click the tile to download. Unzip the data and add to the data folder called “data_wsm”.\n\nsettlement_raster &lt;- terra::rast(paste0(getwd(),\"/data_wsm/GHS_SMOD_E2025_GLOBE_R2023A_54009_1000_V2_0_R11_C2/GHS_SMOD_E2025_GLOBE_R2023A_54009_1000_V2_0_R11_C2.tif\"))\n\nplot(settlement_raster,main=\"Settlement categories (GHS-SMOD data)\")\n\n\n\n\n\n\n\n\nAs you can see the GHS-SMOD tile covers a large area. We will crop this data shortly!\n\n\nAdministrative Unit Boundaries\nFor the administrative boundaries, we’ll use GADM as it has global coverage and has fully harmonized boundaries (GADM 2022). Download GADM boundaries here by selecting Samoa from the drop down and then clicking “Shapefile”: https://gadm.org/download_country.html\nWe use version 4.1 of the GADM data. If you prefer to use a different version, you can simply edit the file name in the sf::st_read code below. Unzip and add the shapefile to your data_wsm folder.\nRead in level 2 administrative units.\n\nadmin_sf &lt;- sf::st_read(paste0(getwd(),\"/data_WSM/gadm41_WSM_shp/gadm41_WSM_2.shp\"))\n\nReading layer `gadm41_WSM_2' from data source \n  `/Users/clairedooley/Documents/Research/gridEZ/gridEZ_tutorials/data_wsm/gadm41_WSM_shp/gadm41_WSM_2.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 43 features and 13 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -172.8041 ymin: -14.07722 xmax: -171.3977 ymax: -13.43981\nGeodetic CRS:  WGS 84\n\n# look at the list of fields in admin_sf\nnames(admin_sf)\n\n [1] \"GID_2\"     \"GID_0\"     \"COUNTRY\"   \"GID_1\"     \"NAME_1\"    \"NL_NAME_1\"\n [7] \"NAME_2\"    \"VARNAME_2\" \"NL_NAME_2\" \"TYPE_2\"    \"ENGTYPE_2\" \"CC_2\"     \n[13] \"HASC_2\"    \"geometry\" \n\n# plot the \"GID_2\" field which contains the level 2 unit IDs\nplot(admin_sf[\"GID_2\"],main=\"Level 2 administrative units for Samoa (GADM data)\")",
    "crumbs": [
      "Tutorial 1: detailed gridEZ example"
    ]
  },
  {
    "objectID": "gridEZ_tutorial1.html#data-processing",
    "href": "gridEZ_tutorial1.html#data-processing",
    "title": "Tutorial 1: detailed gridEZ example",
    "section": "Data Processing",
    "text": "Data Processing\nThe first processing step is to ensure all data have the same coordinate reference system (CRS).\n\n# identify the CRS of the population raster\nr_crs &lt;- terra::crs(population_raster)\n\n# if the strata layers have a different CRS, transform\nif(r_crs !=sf::st_crs(admin_sf)){admin_sf &lt;- sf::st_transform(admin_sf, r_crs)}\nif(r_crs !=terra::crs(settlement_raster)){settlement_raster &lt;- terra::project(settlement_raster,terra::crs(population_raster),method=\"near\")}\n\nNext, we need to convert the sf object containing administrative units into a raster. We do this using the grid of the population raster.\n\n# rasterize admin_sf\nadmin_raster &lt;- terra::rasterize(admin_sf,population_raster,field=\"GID_2\")\n\n# remove admin_sf object as we no long need it\nrm(admin_sf)\n\nThe population data we are using has been constrained to settled areas. This means that grid cells that are settled have a population count and those that are not settled have an NA value. A sampling frame could be created for either settled areas only or for all areas within the focal region or country. There are pros and cons for each approach. We discuss and compare outputs for sampling frames constrained versus unconstrained to settled areas in a later tutorial. For now, we will create sampling frames that cover the whole of Samoa. As gridEZ recognizes any numerical value as a valid population count to be included in the sampling frame, we replace the NA grid cells, that are within the national boundary, with zero counts. We do this to distinguish grid cells inside the focal region/country from those outside the focal region/country. In this case, the outside of our focal country, Samoa, is sea and we certainly don’t want EZs there!\n\n# replace grid cells of NA population counts that also have non-NA administrative unit values with 0 counts\npopulation_raster[is.na(population_raster)&!is.na(admin_raster)] &lt;- 0\n\nNext, we crop the settlement raster to the extent of the administrative units and population rasters.\n\n# crop \nsettlement_raster &lt;- terra::crop(settlement_raster,admin_raster,snap=\"out\",extend=TRUE)\n\nExcellent - now we have three rasters with the same CRS and extents. Let’s re-plot the cropped settlement raster.\n\nplot(settlement_raster, main = \"Settlement categories (GHS-SMOD data)\")\n\n\n\n\n\n\n\n\nGHS classify areas into categories as shown in Table 1. If you’d like to learn more about the classification process, please see section 2.6.2 of this report: https://human-settlement.emergency.copernicus.eu/documents/GHSL_Data_Package_2023.pdf?t=1727170839\n\n\n\n\nTable 1: GHS-SMOD Settlement categories\n\n\n\n\n\n\nCode\nCategory\nMerged categories\n\n\n\n\n10\nWater\nNA\n\n\n11\nMostly inhabited\nRural\n\n\n12\nDispersed rural\nRural\n\n\n13\nVillage\nRural\n\n\n21\nSuburban or peri-urban\nUrban\n\n\n22\nSemi-dense town\nUrban\n\n\n23\nDense town\nUrban\n\n\n30\nCity\nUrban\n\n\n\n\n\n\n\n\nLooking at the settlement map above, we can see there are many instances where small areas of one category are completely surrounded by areas of other categories. Because we use the spatial distribution of these categories to stratify our sampling frame, EZs will never consist of grids cells from more than one category. This means that small areas of one category may have a total population size below the target population per EZ and, because an EZ can not cross strata, will become a single EZ with an undesirably low population size. To remedy this problem, we merge categories to reduce the number of instances this can occur. Table 1 shows how we will merge categories and here is the code to create to update the settlement raster to reflect these merged categories.\n\n# re-define categories\nsettlement_raster[settlement_raster %in% c(30,23,22,21)] &lt;- 1 # urban\nsettlement_raster[settlement_raster %in% c(13,12,11)] &lt;- 2 # rural\nsettlement_raster[settlement_raster == 10] &lt;- NA #water\n\n# re-plot\nplot(settlement_raster, main = \"Merged settlement categories (GHS-SMOD data)\")\n\n\n\n\n\n\n\n\nThe plot shows our new settlement categories with urban and rural areas categorized as 1 and 2, respectively.\nThe final processing step is to increase the spatial resolution of the settlement raster to match the population and administrative unit rasters. We do this using the terra::resample function.\n\nsettlement_raster &lt;- terra::resample(settlement_raster, population_raster, method = \"near\")\n\nSave the three rasters into a folder called “made” inside your “data_wsm” folder.\n\n# check whether the data folder already exists - if not, create the folder \nfile_path &lt;- paste0(getwd(),\"/data_wsm/made/\")\nif (!dir.exists(paste0(file_path))) {\n  dir.create(file_path)\n}\n# save rasters\nterra::writeRaster(admin_raster,paste0(file_path,\"adminGADM.tif\"))\nterra::writeRaster(population_raster,paste0(file_path,\"popWP.tif\"))\nterra::writeRaster(settlement_raster,paste0(file_path,\"settGHS.tif\"))",
    "crumbs": [
      "Tutorial 1: detailed gridEZ example"
    ]
  },
  {
    "objectID": "gridEZ_tutorial1.html#gridez-sampling-frame-generation",
    "href": "gridEZ_tutorial1.html#gridez-sampling-frame-generation",
    "title": "Tutorial 1: detailed gridEZ example",
    "section": "gridEZ: sampling frame generation",
    "text": "gridEZ: sampling frame generation\nThe gridEZ function has been designed so that you can either apply pre-defined specifications or specify your own. More information on this can be found in the Tutorial Overview. Below we demonstrate both approaches.\nIf a sampling frame is being generated for a large geographic area the code will require a significant amount of computer memory. It is therefore good practice to remove R objects not being used and carry out a “garbage collection” before we start.\n\n# remove all objects\nrm()\n# garbage collection\ngc()\n\n          used (Mb) gc trigger  (Mb) limit (Mb) max used  (Mb)\nNcells 1681990 89.9    3058037 163.4         NA  3058037 163.4\nVcells 2493854 19.1   10146329  77.5      36864  8668634  66.2\n\n\ngridEZ utilises parallel processing to generate EZs for different strata at the same time. The number of parallel jobs that can be executed will depend on your computing system. You can work this out using the following code.\n\n# total number of cores available on your computer\nparallel::detectCores() \n\n[1] 14\n\n# we advise that you use your total number of cores minus 1 but you could use fewer (unless you only acces to one core, then you should specify 1 processing core) \nprocessing_cores &lt;- max(parallel::detectCores() - 1, 1)\nprocessing_cores\n\n[1] 13\n\n\nThe gridEZ function reads input rasters straight from file so there is no need to read them into R before executing the function. Instead we define where you would like input rasters to be read in from and also where you would like outputs to be saved. These file pathways can be specified directly in the gridEZ function, however, I find it cleaner and easier to define these file pathways as objects with much shorter names.\n\n# input\nfile_path_inputs &lt;- paste0(getwd(),\"/data_wsm/made/\")\n\n# output\n# check whether the output folders already exists - if not, create them\nfile_path_outputs_tuts &lt;- paste0(getwd(),\"/results_wsm/\")\nif (!dir.exists(paste0(file_path_outputs_tuts))) {\n  dir.create(file_path_outputs_tuts)\n}\nfile_path_outputs &lt;- paste0(getwd(),\"/results_wsm/tutorial1/\")\nif (!dir.exists(paste0(file_path_outputs))) {\n  dir.create(file_path_outputs)\n}\n\nNow we can create our sampling frame. We’ll use the “large” EZ specifications so our sampling frame will be made up of EZs with population sizes mostly between 800 and 1,600.\nWe’ll generate the same sampling frame with two different approaches to demonstrate the different ways gridEZ can be applied: first using the predefined specifications, and then using user-defined specifications.\nNote, the run_ID parameter is used to name output files and should be different for each new run of the gridEZ function.\nOk - let’s run gridEZ with pre-defined specifications. To do this we set predefined_EZ_size as TRUE and EZ_target_size as “large”.\n\n# gridEZ function to generate sampling frame with large EZs: pre-defined specs\ngridEZ2::gridEZ(population_raster_path = paste0(file_path_inputs,\"popWP.tif\"), \n                strata1_raster_path = paste0(file_path_inputs,\"adminGADM.tif\"), \n                strata2_raster_path = paste0(file_path_inputs,\"settGHS.tif\"),\n                predefined_EZ_size = TRUE, \n                EZ_target_size = \"large\",\n                output_path = paste0(file_path_outputs), \n                run_ID = \"wsm_large\",\n                ncores=processing_cores)\n\nIn this example we are creating a sampling frame made up of “large” EZs but you can also produce sampling frames with “medium” or “small” EZs using the pre-defined gridEZ specifications. To do this you would replace “large” in the code above with “medium” or “small”.\nNow let’s run gridEZ with user-defined specifications. We do this by setting predefined_EZ_size to be FALSE and specifying the parameters target_pop_per_EZ and max_cells_per_EZ.\nNote, that the default for predefined_EZ_size is TRUE so if it is not included by the user, gridEZ will ignore target_pop_per_EZ and max_cells_per_EZ and the outputs will have (default) medium sized EZs.\n\n# gridEZ function to generate sampling frame with large EZs: user-defined specs\ngridEZ2::gridEZ(population_raster_path = paste0(file_path_inputs,\"popWP.tif\"), \n                strata1_raster_path = paste0(file_path_inputs,\"adminGADM.tif\"), \n                strata2_raster_path = paste0(file_path_inputs,\"settGHS.tif\"),\n                predefined_EZ_size = FALSE,\n                target_pop_per_EZ = 1200,\n                max_cells_per_EZ = 2500,\n                output_path = paste0(file_path_outputs), \n                run_ID = \"wsm_large_ownspecs\",\n                ncores=processing_cores)\n\nAs you can see from the code above, the user-defined specifications route offers flexibility as target_pop_per_EZ and max_cells_per_EZ can be tailored to specific survey needs.\nGreat - now we can look at the results!",
    "crumbs": [
      "Tutorial 1: detailed gridEZ example"
    ]
  },
  {
    "objectID": "gridEZ_tutorial1.html#evaluating-gridded-sampling-frames",
    "href": "gridEZ_tutorial1.html#evaluating-gridded-sampling-frames",
    "title": "Tutorial 1: detailed gridEZ example",
    "section": "Evaluating Gridded Sampling Frames",
    "text": "Evaluating Gridded Sampling Frames\nThe gridEZ function produces two output files:\n\n.csv with file name beginning “EZ_Pop_Ncells_”. Tabular results for EZs within the sampling frame.\n.tif (raster) with file name beginning “EZ_IDs_”. Raster of the sampling frame.\n\nLet’s start by looking at the outputs for the sampling frame generated using the pre-defined settings.\n\n# read in EZs table of your sampling frame \nEZ_tab &lt;- read.csv(paste0(file_path_outputs, \"EZ_Pop_Ncells_wsm_large.csv\"),header=T)\n# number of EZs in your sampling frame\nnrow(EZ_tab)\n\n[1] 305\n\n# the first rows\nhead(EZ_tab)\n\n  EZ_ID       pop    N\n1     1  947.8968  200\n2     2 1257.4823  200\n3     3 1163.7940  217\n4     4  908.7108  492\n5     5  967.2034 1508\n6     6  923.8834  668\n\n\nEach row of the table gives the results for each EZ. There are 305 rows, i.e. 305 EZs in the sampling frame. From the top row, we know that the focal EZ has an ID of 1, a population size of 948, and contains 200 grid cells.\nTo check that the sampling frame generated using the user-defined settings is the same, we can compare EZ tables.\n\n# read in EZs table of your sampling frame \nEZ_tab_ownspecs &lt;- read.csv(paste0(file_path_outputs, \"EZ_Pop_Ncells_wsm_large_ownspecs.csv\"),header=T)\n# number of EZs in your sampling frame\nnrow(EZ_tab_ownspecs)\n\n[1] 305\n\n# the first rows\nhead(EZ_tab_ownspecs)\n\n  EZ_ID       pop    N\n1     1  947.8968  200\n2     2 1257.4823  200\n3     3 1163.7940  217\n4     4  908.7108  492\n5     5  967.2034 1508\n6     6  923.8834  668\n\n\nFrom this we can see that the same sampling frame has been made. The goal of creating the two sampling frames was to demonstrate the two different approached. Now you have everything you need to start creating sampling frames using a variety of target EZ sizes.\nLet’s carry on evaluating our sampling frame (we could use either pre- or user-defined outputs here). First, we’ll create a map of the EZs.\n\n# read in your sampling frame raster & plot\nEZ &lt;- terra::rast(paste0(file_path_outputs,\"EZ_IDs_wsm_large.tif\"))\n\n# simple plot\n# convert to sf polygons\nres_poly &lt;- terra::as.polygons(EZ, dissolve = TRUE)\nres_poly &lt;- sf::st_as_sf(res_poly)\n# merge the ppolygons and EZ IDs\nres_poly &lt;- merge(res_poly,EZ_tab,by=\"EZ_ID\")\n# plot EZ polygons coloured by EZ IDs\nplot(res_poly[,\"geometry\"],main=\"Spatial distribution of EZs\")\n\n\n\n\n\n\n\n\nThe plot above shows the EZ boundaries. Now let’s look at the population sizes of the EZs.\n\n# plot EZ polygons coloured by population per EZ\nplot(res_poly[,\"pop\"],main=\"EZ population size\")\n\n\n\n\n\n\n\n\nEZs with relatively low population size are located in the centre of the islands where the population is sparse. But if we had a target population per EZ, shouldn’t all the EZs be within the desirable range of 800-1600 for the “large” EZ setting? No - because we also have a maximum geographic size per EZ too! Let’s map the number of grid cells per EZ.\n\n# plot EZ polygons coloured by number of grid cells per EZ\nplot(res_poly[,\"N\"],main=\"EZ grid cells count\")\n\n\n\n\n\n\n\n\nThe maximum geographic size per EZ for the large EZ setting is 2,500 grid cells. However, gridEZ allows blocks up to 1.5 times the value given for the maximum geographic size to be accepted as an EZ. So in our example this is 3,750. The gridEZ function allows this leeway above the ideal maximum geographic size per EZ because the requirement to create compact shapes restricts how the algorithm can combine/split blocks of grid cells. Without this extra flexibility, we’d end up with many EZs much smaller than the maximum geographic size that also have low population counts - two undesirable traits. It is better for an EZ to be slightly larger in geographic size if that helps keep its population closer to the target.\nIf a survey design requires a very strict maximum geographic size of survey units, the max_cells_per_EZ parameter can be adjusted accordingly, e.g. if the hard limit is 1,500 grid cells, the user could set max_cells_per_EZ to be 1,000. In this case, most sparsely populated EZs would have sizes close to 1,000 cells and only some would have sizes close to 1,500.\nNow that we’ve looked at the spatial distribution of population and grid cells per EZ, let’s create a scatter plot to look at the two EZ characteristics together.\n\nggplot(res_poly, aes(x = N, y = pop)) +\n  \n  # grey scatter plot area for values within acceptable values\n  annotate(\"rect\",\n           xmin = 0, xmax = 3750,\n           ymin = 800, ymax = 1600,\n           fill = \"grey30\", alpha = 0.2) +\n  \n  annotate(\"rect\",\n           xmin = 1875, xmax = 3750,\n           ymin = 0, ymax = 800,\n           fill = \"grey30\", alpha = 0.2) +\n  \n  geom_point(alpha = 0.7, size = 3) +\n  \n  # include threshold lines\n  geom_hline(yintercept = c(800, 1600),\n             colour = \"red\", linetype = \"dashed\") +\n  geom_vline(xintercept = c(1875, 3750),\n             colour = \"blue\", linetype = \"dashed\") +\n  \n  theme_minimal() +\n  labs(\n    x = \"grid cells per EZ\",\n    y = \"pop count per EZ\",\n    title = \"\"\n  )\n\n\n\n\n\n\n\n\nThe red horizontal lines indicate the desirable range for population per EZ and the blue vertical lines show the acceptable geographic size range for EZs with undesirably low population. You can see that no EZs are geographically larger than the acceptable maximum grid cells per EZ of 3,750. Therefore, all the EZs that fall between the red horizontal lines meet our criteria for ideal EZs (n = 169). The EZs that fall between the blue vertical lines but below the lower red horizontal line have a desirable geographic size given that they are located in sparsely populated areas. These are acceptable EZs (n=83). Generally, all EZs sitting outside of these areas on the scatter plot, (i.e. outside of the grey areas), are not considered to be acceptable EZs given our criteria.\nHowever, there are a number of restrictions that may lead to the criteria not being met. One example is when a single grid cell has population size greater than the upper end of the desirable population range, e.g. in densely populated areas of cities. The grid based nature of our algorithm means that we can not split individual grid cells and so these become individual EZs. On the scatter plot these EZs would be plotted on the far left (1 grid cell per EZ) above the upper red horizontal line. We can see from our scatter plot that, in this example, there are no single cell EZs with population size greater than 1,600 so no EZs fall into this category.\nFor our sampling frame, let’s investigate all the EZs outside of the grey areas on our scatter plot. To help with this, we can categorize the EZs by where they sit on the scatter plot using the following code.\n\nres_poly$cat &lt;- NA\n# category 1: meets pop and geog criteria \nres_poly$cat[res_poly$N&lt;=3750 & res_poly$pop&gt;=800 & res_poly$pop&lt;=1600] &lt;- 1\n# category 2: low pop but meets max geog range\nres_poly$cat[res_poly$N&gt;=1875 & res_poly$N&lt;=3750 & res_poly$pop&lt;800] &lt;- 2\n# category 3: high pop but only 1 cell\nres_poly$cat[res_poly$N==1 & res_poly$pop&gt;1600] &lt;-3\n# category 4: below max geog range but over pop max and has more than 1 cell\nres_poly$cat[res_poly$N&gt;1 & res_poly$pop&gt;1600] &lt;- 4\n# category 5: pop & cell count are too low\nres_poly$cat[res_poly$N&lt;1875 & res_poly$pop&lt;800] &lt;- 5\n\nres_poly$cat &lt;- as.factor(res_poly$cat)\n\n# re-do scatter plot colour coded by category\n\n# define the colour coding first\ncat_cols &lt;- scales::hue_pal()(5)\n\nggplot(res_poly, aes(x = N, y = pop, colour = cat)) +\n  geom_point(size = 3, alpha = 0.8) +\n  scale_colour_manual(values = cat_cols) +\n  theme_minimal() +\n  labs(\n    x = \"grid cells per EZ\",\n    y = \"pop count per EZ\",\n    colour = \"Category\",\n    title = \"\"\n  )\n\n\n\n\n\n\n\n\nCateogories 1 and 2 correspond to the EZs we described above. Category 3 corresponds to single celled EZs with high population counts - as mentioned, we don’t have any in this Samoa example. Category 4 consists of EZs whose population size is too big based on our criteria and category 5 consists of EZs whose population size is too small based on our criteria. Let’s count the EZs in each category:\n\ntable(res_poly$cat)\n\n\n  1   2   4   5 \n169  83   5  48 \n\n\nThere are 252 EZs that fall into categories 1 and 2 out of a total of 305 EZs in our sampling frame (i.e. 83%. of all our EZs). There are 5 EZs in category 4 and 48 EZs in category 5. We can map the EZs by category to see where they are located.\n\nplot(res_poly[\"cat\"], pal = cat_cols, main=\"EZs by evaluation category\")\n\n\n\n\n\n\n\n\nStraight away we can easily see a handful of EZs in category 5. Given their category, can you guess which points in the scatter plot correspond to these? Hint: their geographic size is only slightly below the target grid cells per EZ for sparsely populated areas. Of greater concern are the EZs that are very small in both population and geographic size. Let’s zoom in on an area to take a closer look.\n\n# zoomed in map\nplot(res_poly[\"cat\"], pal = cat_cols,ylim=c(-13.96,-13.77),xlim=c(-172.27,-171.95), main=\"EZs by evaluation category - zoomed in\")\n\n\n\n\n\n\n\n\nSamoa consists of two main island - Savai’i in the west and Upolu in the east - and many smaller islands. Here we see a tiny island situated between the two main islands that has a single EZ which is in category 5, i.e. population smaller than the target EZ population size. It is generally preferable to have EZs be contiguous in space so that survey field teams do not need to travel through non-survey unit areas to cover a whole unit. The gridEZ algorithm therefore enforces spatial contiguity for EZs. This results in small islands like this one being one single EZ - in most survey designs, this is preferable over several islands being part of the same EZ.\nNow let’s focus on the section of Upolu that we see in the above map.\n\n# zoom in more and use ggplot\n\n# define the categories plot\np1 &lt;- ggplot(res_poly) +\n  geom_sf(aes(fill = cat), colour = \"black\", linewidth = 0.4) +\n  scale_fill_manual(values = cat_cols) +   # same palette as before\n  coord_sf(\n    xlim = c(-172.08, -171.98),\n    ylim = c(-13.95, -13.82),\n    expand = FALSE\n  ) +\n  theme_minimal() +\n  labs(\n    fill = \"Category\",\n    x = \"Longitude\",\n    y = \"Latitude\",\n    title = \"\"\n  )\n\n# read in the settlement raster and admin polygons\nsettlement_raster &lt;- terra::rast(paste0(file_path_inputs,\"settGHS.tif\"))\nadmin_sf &lt;- sf::st_read(paste0(getwd(),\"/data_WSM/gadm41_WSM_shp/gadm41_WSM_2.shp\"))\n\nReading layer `gadm41_WSM_2' from data source \n  `/Users/clairedooley/Documents/Research/gridEZ/gridEZ_tutorials/data_wsm/gadm41_WSM_shp/gadm41_WSM_2.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 43 features and 13 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -172.8041 ymin: -14.07722 xmax: -171.3977 ymax: -13.43981\nGeodetic CRS:  WGS 84\n\n# plot these survey strata\n# convert the raster into a data.frame first\nsettlement_df &lt;- as.data.frame(settlement_raster, xy = TRUE, na.rm = FALSE)\nsettlement_df$GHS_SMOD_E2025_GLOBE_R2023A_54009_1000_V2_0_R11_C2 &lt;- as.factor(settlement_df$GHS_SMOD_E2025_GLOBE_R2023A_54009_1000_V2_0_R11_C2)\n# define strata plot\np2 &lt;- ggplot() +\n  geom_raster(data = settlement_df, aes(x = x, y = y, fill = GHS_SMOD_E2025_GLOBE_R2023A_54009_1000_V2_0_R11_C2)) +\n  geom_sf(data = admin_sf, fill = NA, colour = \"black\", linewidth = 0.7) +\n  scale_fill_scico_d(palette = \"nuuk\", na.value = \"transparent\") +\n  coord_sf(\n    xlim = c(-172.08, -171.98),\n    ylim = c(-13.95, -13.82),\n    expand = FALSE\n  ) +\n  theme_minimal() +\n  labs(\n    fill = \"Value\",\n    x = \"Longitude\",\n    y = \"Latitude\",\n    title = \"\"\n  )\n\np1 + p2\n\n\n\n\n\n\n\n\nIn the left hand plot we see several category 5 EZs. The right hand plot shows our two strata layers. The overall spatial stratification for the sampling frame is a combination of the two, i.e. stratum 1 = settlement type 1 in admin unit A; stratum 2 = settlement type 2 in admin unit A; stratum 3 = settlement type 1 in admin unit B; stratum 4 = settlement type 2 in admin unit B; etc. The overall spatial stratification delineates what we consider “uncrossable” boundaries and gridEZ therefore does not allow EZs to cross different strata. EZs are always contained within one stratum. This stratification approach is important for survey design but can lead to EZs with small population and small geograhpic size, depending on how the layers used to define the overall stratification intersect with one another. In our example, the overall stratification based on GHS-SMOD and GADM administrative units essentially consists of little psuedo islands within the landmass and explains most of the category 5 EZs that we see in the left hand plot above.\nThe gridEZ algorithm balances compactness of EZ shapes against meeting the population and geographic criteria. In several cases, this can lead to a decision not to add or split a block of grid cells and instead call it good as an EZ. This is the likely explanation for the remaining EZs in categories 4 and 5.",
    "crumbs": [
      "Tutorial 1: detailed gridEZ example"
    ]
  },
  {
    "objectID": "gridEZ_tutorial1.html#creation-of-table-for-survey-sample-selection",
    "href": "gridEZ_tutorial1.html#creation-of-table-for-survey-sample-selection",
    "title": "Tutorial 1: detailed gridEZ example",
    "section": "Creation of table for survey sample selection",
    "text": "Creation of table for survey sample selection\nSurveys require a table of survey sampling frame units (here, these are EZs) to sample from. We currently have a table of EZs and their population counts, but as many surveys will want to sample a specific number of units per stratum (stratified sampling) we need to add the corresponding stratum for each EZ.\nWe can do this by spatially linking the EZ IDs raster with the two strata rasters. The result is a table containing the information from the three rasters.\n\n# read in the strata raster\nadmin_raster &lt;- terra::rast(paste0(file_path_inputs,\"adminGADM.tif\"))\nsettlement_raster &lt;- terra::rast(paste0(file_path_inputs,\"settGHS.tif\"))\n\n# the extent of the EZ raster is defined by the presence of EZs and may be different to the extent of the input files which was set by the population raster\n# remember EZs are created for grid cells with non-NA values across all 3 input rasters, not everywhere there is population\n# because of this we extend the EZ raster to match the input rasters\nEZ &lt;- terra::extend(EZ,admin_raster)\n\n# create a table of EZ strata values\n\n# we need to create a table with vectors of values in each raster\n# as the admin_raster contains categories, we want the category labels rather than their corresponding numeric value\nadmin_cats &lt;- terra::cats(admin_raster)[[1]]\nadmin_labels &lt;- admin_cats[match(admin_raster[], admin_cats[,1]),2]\n# as we defined the distance categories by numeric values, we can directly use those raster values\nEZ_strata &lt;- data.table::data.table(EZ[],\n                                    admin_labels,\n                                    settlement_raster[])\n# set column names, change as needed\nnames(EZ_strata) &lt;- c(\"EZ_ID\",\"strata1\",\"strata2\") \n# reduce table down to a single row per EZ\nEZ_strata &lt;- na.omit(EZ_strata)\nEZ_strata &lt;- unique(EZ_strata)\n\nLet’s have a look at the top of the table.\n\n# look at the top of the table\nhead(EZ_strata)\n\n   EZ_ID   strata1 strata2\n   &lt;num&gt;    &lt;char&gt;   &lt;num&gt;\n1:    98 WSM.5.4_1       2\n2:    96 WSM.5.3_1       2\n3:   100 WSM.6.1_1       2\n4:   105 WSM.6.2_1       2\n5:   101 WSM.6.1_1       2\n6:    99 WSM.5.4_1       2\n\n\nGreat - looks good. Now we can merge it with our EZ table that we read in from the .csv file produced by gridEZ so that we have EZ population and strata information all in one table.\n\n# merge\nEZ_tab &lt;- merge(EZ_tab,EZ_strata,by=\"EZ_ID\")\n# check number of rows/EZs\nnrow(EZ_tab)\n\n[1] 305\n\n# look at the top of the table\nhead(EZ_tab)\n\n  EZ_ID       pop    N   strata1 strata2\n1     1  947.8968  200 WSM.1.1_1       1\n2     2 1257.4823  200 WSM.1.1_1       1\n3     3 1163.7940  217 WSM.1.1_1       1\n4     4  908.7108  492 WSM.1.1_1       2\n5     5  967.2034 1508 WSM.1.1_1       2\n6     6  923.8834  668 WSM.1.1_1       2\n\n\nExcellent - now we have a table with the following characteristic for each EZ in our sampling frame:\n\nID\npopulation count\ngrid cell count\nID of strata 1 (administrative unit)\nID of strata 2 (settlement category)\n\nFinally, it may be useful to count the EZs in each strata. We can summarise this in a table as follows.\n\ntable(EZ_tab$strata1,EZ_tab$strata2)\n\nFor visual inspection we can also plot it.\n\nggplot(EZ_tab, aes(x = strata1, fill = as.factor(strata2))) +\n  geom_bar(position = \"stack\") +\n  labs(\n    title = \"Count of EZs per stratum\",\n    x = \"Admin. unit\",\n    y = \"Count\",\n    fill = \"Settlement type\"\n  ) +\n  theme_minimal() +\n  theme(\n    axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)\n  ) +\n  scale_fill_discrete(labels = c(\"1\" = \"urban\", \"2\" = \"rural\"))",
    "crumbs": [
      "Tutorial 1: detailed gridEZ example"
    ]
  },
  {
    "objectID": "gridEZ_tutorial1.html#summary",
    "href": "gridEZ_tutorial1.html#summary",
    "title": "Tutorial 1: detailed gridEZ example",
    "section": "Summary",
    "text": "Summary\nThis tutorial has covered:\n\npreparing example datasets suitable for the gridEZ R function\ngenerating gridded sampling frames using two gridEZ options:\n\napplying pre-defined specifications\napplying user-defined specifications\n\nsummarising output sampling frames\nevaluating sampling frame EZs\ncreating a table suitable for survey sample selection, i.e. containing EZ ID, population count and strata IDs",
    "crumbs": [
      "Tutorial 1: detailed gridEZ example"
    ]
  },
  {
    "objectID": "gridEZ_tutorial3.html",
    "href": "gridEZ_tutorial3.html",
    "title": "Tutorial 3: alternative sampling frame stratification example",
    "section": "",
    "text": "Suggested citation: Dooley, C.A. (2025). gridEZ Tutorial 3 version 1.0",
    "crumbs": [
      "Tutorial 3: alternative sampling frame stratification example"
    ]
  },
  {
    "objectID": "gridEZ_tutorial3.html#tutorial-aim",
    "href": "gridEZ_tutorial3.html#tutorial-aim",
    "title": "Tutorial 3: alternative sampling frame stratification example",
    "section": "Tutorial Aim",
    "text": "Tutorial Aim\nThe aim of this tutorial is to generate and evaluate a bespoke gridded sampling frame for Samoa stratified by administrative units and distance to coast. This tutorial provides guidance on how to create strata that may be very specific to a survey instead of using widely available data such as settlement type. We use distance to coast for this Samoa example but this could just as easily be distance to any points of interest, e.g. health care facilities or railway stations, depending on the aims of the survey for which the sampling frame is being constructed. The gridded sampling frame will contain gridded Enumeration Zones (EZs) that can be used for sampling survey units.",
    "crumbs": [
      "Tutorial 3: alternative sampling frame stratification example"
    ]
  },
  {
    "objectID": "gridEZ_tutorial3.html#packages",
    "href": "gridEZ_tutorial3.html#packages",
    "title": "Tutorial 3: alternative sampling frame stratification example",
    "section": "Packages",
    "text": "Packages\nLoad all the R packages necessary to complete this tutorial. If you have not yet installed the gridEZ2 package, please follow the instructions on the Tutorial Overview page.\n\n# list of required packages\nrequired_packages &lt;- c(\"sf\", \"terra\", \"parallel\", \"data.table\", \"ggplot2\", \"scico\", \"patchwork\")\n\n# install missing packages\ninstall.packages(setdiff(required_packages, installed.packages()[, \"Package\"]))\n\n# load packages\nlibrary(sf)\nlibrary(terra)\nlibrary(data.table)\nlibrary(parallel)\nlibrary(ggplot2)\nlibrary(scico)\nlibrary(patchwork)\nlibrary(gridEZ2)",
    "crumbs": [
      "Tutorial 3: alternative sampling frame stratification example"
    ]
  },
  {
    "objectID": "gridEZ_tutorial3.html#datasets",
    "href": "gridEZ_tutorial3.html#datasets",
    "title": "Tutorial 3: alternative sampling frame stratification example",
    "section": "Datasets",
    "text": "Datasets\nWe need two publicly available datasets: gridded population estimates and administrative boundaries. We’ll use the WorldPop population data (Bondarenko M. 2025) and the GADM administraive boundare (GADM 2022) that we also used in the previous tutorials. For more information about the population estimates, please see Tutorial 1. Here, we simply use these datasets without revisiting their details.\nAs with the previous Tutorials, we read in datasets from a folder called “data_wsm”. The code below checks whether you have the folder already. If you don’t, the code will create it.\n\n# check your working directory\ngetwd()\n\n# you may need to change your working directory to point to the location where the data_wsm folder sits. Use setwd() to change your working directory if needed\n\n# check whether the data folder already exists - if not, create the folder \nfile_path &lt;- paste0(getwd(),\"/data_wsm/\")\nif (!dir.exists(paste0(file_path))) {\n  dir.create(file_path)\n}\n\n\nPopulation counts data\nYou can read in the data directly from the WorldPop server using Option 1 code snippet or you can download the data via the link below, save it into your “data_wsm” folder and then use Option 2 code snippet to read the data into R.\nhttps://hub.worldpop.org/geodata/summary?id=76095\n\n# Option 1: read in directly from WP server\npopulation_raster &lt;- terra::rast(\"https://data.worldpop.org/GIS/Population/Global_2015_2030/R2025A/2025/WSM/v1/100m/constrained/wsm_pop_2025_CN_100m_R2025A_v1.tif\")\n\n\n# Option 2: read in from file after download\npopulation_raster &lt;- terra::rast(paste0(getwd(),\"/data_wsm/wsm_pop_2025_CN_100m_R2025A_v1.tif\"))\n\n\nplot(population_raster,main=\"Population distribution of Samoa (WorldPop data)\")\n\n\n\n\n\n\n\n\n\n\nAdministrative Unit Boundaries\nThe GADM boundaries can be downloaded here by selecting Samoa from the drop down and then clicking “Shapefile”: https://gadm.org/download_country.html\nAgain, add the unzipped file to your “data_wsm” folder. We’ll use the level 2 administrative units.\n\nadmin_sf &lt;- sf::st_read(paste0(getwd(),\"/data_WSM/gadm41_WSM_shp/gadm41_WSM_2.shp\"))\n\nReading layer `gadm41_WSM_2' from data source \n  `/Users/clairedooley/Documents/Research/gridEZ/gridEZ_tutorials/data_wsm/gadm41_WSM_shp/gadm41_WSM_2.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 43 features and 13 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -172.8041 ymin: -14.07722 xmax: -171.3977 ymax: -13.43981\nGeodetic CRS:  WGS 84\n\n# look at the list of fields in admin_sf\nnames(admin_sf)\n\n [1] \"GID_2\"     \"GID_0\"     \"COUNTRY\"   \"GID_1\"     \"NAME_1\"    \"NL_NAME_1\"\n [7] \"NAME_2\"    \"VARNAME_2\" \"NL_NAME_2\" \"TYPE_2\"    \"ENGTYPE_2\" \"CC_2\"     \n[13] \"HASC_2\"    \"geometry\" \n\n# plot the \"GID_2\" field which contains the level 2 unit IDs\nplot(admin_sf[\"GID_2\"],main=\"Level 2 administrative units for Samoa (GADM data)\")",
    "crumbs": [
      "Tutorial 3: alternative sampling frame stratification example"
    ]
  },
  {
    "objectID": "gridEZ_tutorial3.html#data-processing",
    "href": "gridEZ_tutorial3.html#data-processing",
    "title": "Tutorial 3: alternative sampling frame stratification example",
    "section": "Data Processing",
    "text": "Data Processing\nAs with any spatial analysis, the first step is to ensure the CRS of our datasets is the same.\n\n# identify the CRS of the population raster\nr_crs &lt;- terra::crs(population_raster)\n\n# if the strata layers have a different CRS, transform\nif(r_crs !=sf::st_crs(admin_sf)){admin_sf &lt;- sf::st_transform(admin_sf, r_crs)}\n\nNext, we need to convert the sf object containing administrative units into a raster where each grid cell is classified by the level 2 administrative unit they fall within. We do this using the base grid of the population raster.\n\n# rasterize admin_sf\nadmin_raster &lt;- terra::rasterize(admin_sf,population_raster,field=\"GID_2\")\n\n# remove admin_sf object as we no long need it\nrm(admin_sf)\n\nNow we can create our second strata layer - distance to coast. The administrative units raster we just made contains NA values for the sea. We can therefore duplicate this raster and replace any non-NA values with a single value, e.g. 1, to distinguish between land and sea.\n\n# create a sea raster\nsea_raster &lt;- admin_raster\nvalues(sea_raster) &lt;- ifelse(is.na(values(admin_raster)), 1, NA)\nplot(sea_raster, main=\"Sea around Samoa\")\n\n\n\n\n\n\n\n\nBased on this binary raster, we can create a distance to coast raster using the terra::distance function. This may take a minute or so to run.\n\n# create a distance from coast raster\ndist_raster &lt;- terra::distance(sea_raster)\nplot(dist_raster, main=\"Distance to coastline, Samoa\")\n\n\n\n\n\n\n\n\nFrom this distance raster we can classify grid cells into bands of distances to create strata. Based on the population and geography of Samoa, we’ll use three distance bands. Two would also work. More would end out cutting up the land into quite small areas - remember that we will also stratify by administrative units too. Our bands will be:\n\nBand 1: 0–2 km\nBand 2: 2–5 km\nBand 3: &gt;5 km\n\n\n# reclassify into distance bands\n# 0–2 km = band 1, 2–5 km = band 2, &gt;5 km = band 3\nrcl &lt;- matrix(c(\n  0,    2000, 1,\n  2000, 5000, 2,\n  5000, Inf,  3\n), ncol = 3, byrow = TRUE)\ndist_raster &lt;- terra::classify(dist_raster, rcl)\nplot(dist_raster, main=\"Categorized distance to coastline, Samoa\")\n\n\n\n\n\n\n\n\nLet’s confirm that these bands categories are sensible given the population distribution of Samoa. We do this using the terra::zonal function to sum up the population inside each band.\n\n# calculate population in each band to check they are sensible distances\npop_per_band &lt;- terra::zonal(population_raster, dist_raster, fun = \"sum\", na.rm = TRUE)\n# calculate percentage of pop in each band\npop_per_band$perc_total_pop &lt;- round(pop_per_band[,2]/sum(pop_per_band[,2])*100,2)\npop_per_band\n\n  GID_2 wsm_pop_2025_CN_100m_R2025A_v1 perc_total_pop\n1     0                       128.1908           0.06\n2     1                    157209.1857          71.89\n3     2                     49739.3929          22.74\n4     3                     11608.5353           5.31\n\n\nApproximately 72% of the population falls within 2km of the coastline (band 1) and there is about 23% of the population between 2 and 5kms of the coastline. A small portion (~5%) of the population live more than 5km away from the coastline. According to our definition of where the coastline sits, about 128 people live in the sea. This may be due to the way the administrative units are rasterized. If the polygon line of the boundary does not cross the centroid of a grid cell, that grid cell is assumed to be outside of the polygon. In reality, the rasterization step can lead to partially populated grid cells being incorrectly counted as outside the country. This may also occur if the population data and (unrasterized) administrative unit boundaries don’t align.\nThis mismatch in datasets is a common issue. The datasets can be reviewed to determine whether any real population might be excluded and to decide if additional steps are needed. We cover this in Tutorial X. For now we will continue with the rasters that we have.\nThe final step of the data processing is to save the three rasters into a folder called “made” inside your “data_wsm” folder.\n\n# check whether the data folder already exists - if not, create the folder \nfile_path &lt;- paste0(getwd(),\"/data_wsm/made/\")\nif (!dir.exists(paste0(file_path))) {\n  dir.create(file_path)\n}\n\n# save pop and admin rasters if they don't already exist\n# as these rasters are the same as in Tutorial 1, we check whether they exist first and only save if they don't\nif (!file.exists(paste0(file_path,\"adminGADM.tif\"))){\n  terra::writeRaster(admin_raster,paste0(file_path,\"adminGADM.tif\"))\n}\nif (!file.exists(paste0(file_path,\"popWP.tif\"))){\n  terra::writeRaster(population_raster,paste0(file_path,\"popWP.tif\"))\n}\n\n# save the categorized distance to coast raster \nterra::writeRaster(dist_raster,paste0(file_path,\"disttocoast.tif\"))",
    "crumbs": [
      "Tutorial 3: alternative sampling frame stratification example"
    ]
  },
  {
    "objectID": "gridEZ_tutorial3.html#gridez-sampling-frame-generation",
    "href": "gridEZ_tutorial3.html#gridez-sampling-frame-generation",
    "title": "Tutorial 3: alternative sampling frame stratification example",
    "section": "gridEZ: sampling frame generation",
    "text": "gridEZ: sampling frame generation\nIn the next chunk of code, we run gridEZ to generate a sampling frame consisting of “large” EZs and stratified by administrative units and distance to coast categories.\n\n# clear R environment\nrm(list=ls())\ngc()\n\n          used (Mb) gc trigger  (Mb) limit (Mb) max used  (Mb)\nNcells 1671851 89.3    3077995 164.4         NA  2448270 130.8\nVcells 2531109 19.4   10146329  77.5      36864 10146047  77.5\n\n# define number of cores for parallel processing\nprocessing_cores &lt;- max(parallel::detectCores() - 1, 1)\n\n# define input & output file pathways (checking output folders exist & creating them if they don't)\nfile_path_inputs &lt;- paste0(getwd(),\"/data_wsm/made/\")\nfile_path_outputs_tuts &lt;- paste0(getwd(),\"/results_wsm/\")\nif (!dir.exists(paste0(file_path_outputs_tuts))) {\n  dir.create(file_path_outputs_tuts)\n}\nfile_path_outputs &lt;- paste0(getwd(),\"/results_wsm/tutorial3/\")\nif (!dir.exists(paste0(file_path_outputs))) {\n  dir.create(file_path_outputs)\n}\n\n\n# gridEZ code: stratification by level 2 admin units & distance to coast categories\ngridEZ2::gridEZ(population_raster_path  &lt;- paste0(file_path_inputs,\"popWP.tif\"),\n                strata1_raster_path  &lt;- paste0(file_path_inputs,\"adminGADM.tif\"),\n                strata2_raster_path  &lt;- paste0(file_path_inputs,\"disttocoast.tif\"),\n                predefined_EZ_size = TRUE,\n                EZ_target_size = \"large\",\n                output_path = paste0(file_path_outputs),\n                run_ID = \"wsm_wp_large_disttocoast\",\n                ncores=processing_cores)",
    "crumbs": [
      "Tutorial 3: alternative sampling frame stratification example"
    ]
  },
  {
    "objectID": "gridEZ_tutorial3.html#resulting-sampling-frame",
    "href": "gridEZ_tutorial3.html#resulting-sampling-frame",
    "title": "Tutorial 3: alternative sampling frame stratification example",
    "section": "Resulting sampling frame",
    "text": "Resulting sampling frame\ngridEZ outputs a table (.csv file) containing EZ level information on population and geographic size and a raster containing the spatial layouts of the EZs. Let’s read in the table.\n\n# read in EZs table of your sampling frame \nEZ_tab &lt;- read.csv(paste0(file_path_outputs, \"EZ_Pop_Ncells_wsm_wp_large_disttocoast.csv\"),header=T)\n# number of EZs in your sampling frame\nnrow(EZ_tab)\n\n[1] 336\n\n# the first rows\nhead(EZ_tab)\n\n  EZ_ID      pop    N\n1     1 1465.795  444\n2     2 1488.862  307\n3     3 1048.678  132\n4     4 1006.009  301\n5     5  954.669  915\n6     6 1135.277 1509\n\n\nEach row of the table gives information for an individual EZ. There are 336 rows in the table which means there are 336 EZs in the sampling frame. From the top row, we can see that there is an EZ with an ID of 1, a population size of 1466, and contains 444 grid cells.\nLet’s create a map of the sampling frame. We can plot the raster or we can convert the raster into polygons and map that.\n\n# read in your sampling frame raster & plot\nEZ &lt;- terra::rast(paste0(file_path_outputs,\"EZ_IDs_wsm_wp_large_disttocoast.tif\"))\n\n# plot raster\ncols &lt;- sample(scico(nrow(EZ_tab)/2, palette = \"broc\"))\nplot(EZ,main=\"Spatial distribution of EZs (raster)\",col=cols)\n\n\n\n\n\n\n\n# convert to sf polygons\nres_poly &lt;- terra::as.polygons(EZ, dissolve = TRUE)\nres_poly &lt;- sf::st_as_sf(res_poly)\n# merge the ppolygons and EZ IDs\nres_poly &lt;- merge(res_poly,EZ_tab,by=\"EZ_ID\")\n# plot EZ polygons coloured by EZ IDs\nplot(res_poly[,\"geometry\"],main=\"Spatial distribution of EZs (polygons)\")\n\n\n\n\n\n\n\n\nThe raster values are the IDs of the EZs. Even with a nice colour palette it can be difficult to distinguish EZs from one another. Converting the raster to EZ polygons makes it easier to see the EZ boundaries.\nFrom the shapes of the EZs, we can pick out their alignment with our (categorised) distance to coast strata as well as the administrative units (both mapped above). Success!\nLet’s map the population and geographic sizes of the EZs to check that they look sensible for “large” EZs.\n\n# plot EZ polygons coloured by population per EZ\nplot(res_poly[,\"pop\"],main=\"EZ population size\")\n\n\n\n\n\n\n\n# plot EZ polygons coloured by number of grid cells per EZ\nplot(res_poly[,\"N\"],main=\"EZ grid cells count\")\n\n\n\n\n\n\n\n\nGenerally, EZ population counts are within a reasonable range of the target EZ population of 1,200 in areas that are not sparsely populated (near the coast) and EZ geographic sizes are close to the maximum of 2,500 grid cells in sparsely populated areas (centre of the main islands).",
    "crumbs": [
      "Tutorial 3: alternative sampling frame stratification example"
    ]
  },
  {
    "objectID": "gridEZ_tutorial3.html#creation-of-table-for-survey-sample-selection",
    "href": "gridEZ_tutorial3.html#creation-of-table-for-survey-sample-selection",
    "title": "Tutorial 3: alternative sampling frame stratification example",
    "section": "Creation of table for survey sample selection",
    "text": "Creation of table for survey sample selection\nWe can identify the strata that each EZ belong to using the EZ IDs raster along with the two strata rasters. Here, we create a table containing the information from these three rasters.\n\n# read in the strata raster\nadmin_raster &lt;- terra::rast(paste0(file_path_inputs,\"adminGADM.tif\"))\ndist_raster &lt;- terra::rast(paste0(file_path_inputs,\"disttocoast.tif\"))\n\n# create a table of EZ strata values\n\n# ensure the EZ raster has the same extent as the gridEZ input rasters\nEZ &lt;- terra::extend(EZ,admin_raster)\n# we need to create a table with vectors of values in each raster\n# as the admin_raster contains categories, we want the category labels rather than their corresponding numeric value\nadmin_cats &lt;- terra::cats(admin_raster)[[1]]\nadmin_labels &lt;- admin_cats$GID_2[match(admin_raster[], admin_cats$value)]\n# as we defined the distance categories by numeric values, we can directly use those raster values\nEZ_strata &lt;- data.table::data.table(EZ[],\n                                    admin_labels,\n                                    dist_raster[])\n# set column names, change as needed\nnames(EZ_strata) &lt;- c(\"EZ_ID\",\"strata1\",\"strata2\") \n# reduce table down to a single row per EZ\nEZ_strata &lt;- na.omit(EZ_strata)\nEZ_strata &lt;- unique(EZ_strata)\n\nLet’s have a look at the top and bottom of the table.\n\n# look at the top of the table\nhead(EZ_strata)\n\n   EZ_ID   strata1 strata2\n   &lt;num&gt;    &lt;char&gt;   &lt;num&gt;\n1:   123 WSM.5.4_1       1\n2:   122 WSM.5.4_1       1\n3:   119 WSM.5.3_1       1\n4:   126 WSM.6.1_1       1\n5:   128 WSM.6.2_1       1\n6:   112 WSM.5.2_1       1\n\ntail(EZ_strata)\n\n   EZ_ID   strata1 strata2\n   &lt;num&gt;    &lt;char&gt;   &lt;num&gt;\n1:    73 WSM.3.7_1       1\n2:    40 WSM.3.2_1       2\n3:    71 WSM.3.7_1       1\n4:    41 WSM.3.2_1       2\n5:    37 WSM.3.2_1       1\n6:    38 WSM.3.2_1       1\n\n\nGreat - looks good. Now we can merge it with our EZ table that we read in from the .csv file produced by gridEZ.\n\n# merge\nEZ_tab &lt;- merge(EZ_tab,EZ_strata,by=\"EZ_ID\")\n# check number of rows/EZs\nnrow(EZ_tab)\n\n[1] 336\n\n# look at the top of the table\nhead(EZ_tab)\n\n  EZ_ID      pop    N   strata1 strata2\n1     1 1465.795  444 WSM.1.1_1       1\n2     2 1488.862  307 WSM.1.1_1       1\n3     3 1048.678  132 WSM.1.1_1       1\n4     4 1006.009  301 WSM.1.1_1       2\n5     5  954.669  915 WSM.1.1_1       2\n6     6 1135.277 1509 WSM.1.1_1       3\n\n\nExcellent - now we have a table with the following characteristic for each EZ in our sampling frame:\n\nID\npopulation count\ngrid cell count\nID of strata 1 (administrative unit)\nID of strata 2 (distance to coast category)\n\nWe can summarise the count of EZs per strata using the following code.\n\ntable(EZ_tab$strata1,EZ_tab$strata2)\n\nOr we can plot the counts to visualise these results.\n\nggplot(EZ_tab, aes(x = strata1, fill = as.factor(strata2))) +\n  geom_bar(position = \"stack\") +\n  labs(\n    title = \"Count of EZs per stratum\",\n    x = \"Admin. unit\",\n    y = \"Count\",\n    fill = \"Distance to coast\"\n  ) +\n  theme_minimal() +\n  theme(\n    axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)\n  ) +\n  scale_fill_discrete(labels = c(\"1\" = \"0-2km\", \"2\" = \"2-5km\", \"3\" = \"&gt;5km\"))",
    "crumbs": [
      "Tutorial 3: alternative sampling frame stratification example"
    ]
  },
  {
    "objectID": "gridEZ_tutorial3.html#summary",
    "href": "gridEZ_tutorial3.html#summary",
    "title": "Tutorial 3: alternative sampling frame stratification example",
    "section": "Summary",
    "text": "Summary\nThis tutorial has covered:\n\npreparing datasets suitable for producing a sampling frame stratified by administrative units and distance to coast\ngenerating gridded sampling frames using the gridEZ function\nmapping the output sampling frame\ncreating a table suitable for survey sample selection, i.e. containing EZ ID, population count and strata IDs",
    "crumbs": [
      "Tutorial 3: alternative sampling frame stratification example"
    ]
  }
]