<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Claire Dooley">

<title>Tutorial 2: applying gridEZ to different population datasets – Tutorials for Generating Gridded Sampling Frames</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./gridEZ_tutorial3.html" rel="next">
<link href="./gridEZ_tutorial1.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-1bea93ccc161f891f1f595952294239b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<!-- Google tag (gtag.js) -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-QFGDL91VLC"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-QFGDL91VLC');
</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./gridEZ_tutorial2.html">Tutorial 2: applying gridEZ to different population datasets</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Tutorials for Generating Gridded Sampling Frames</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gridEZ_tutorial1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tutorial 1: detailed gridEZ example</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gridEZ_tutorial2.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Tutorial 2: applying gridEZ to different population datasets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gridEZ_tutorial3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tutorial 3: alternative sampling frame stratification example</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#tutorial-aim" id="toc-tutorial-aim" class="nav-link active" data-scroll-target="#tutorial-aim">Tutorial Aim</a></li>
  <li><a href="#packages" id="toc-packages" class="nav-link" data-scroll-target="#packages">Packages</a></li>
  <li><a href="#datasets" id="toc-datasets" class="nav-link" data-scroll-target="#datasets">Datasets</a>
  <ul>
  <li><a href="#population-counts-data" id="toc-population-counts-data" class="nav-link" data-scroll-target="#population-counts-data">Population counts data</a>
  <ul class="collapse">
  <li><a href="#ghs-pop" id="toc-ghs-pop" class="nav-link" data-scroll-target="#ghs-pop">GHS-POP</a></li>
  <li><a href="#worldpop" id="toc-worldpop" class="nav-link" data-scroll-target="#worldpop">WorldPop</a></li>
  </ul></li>
  <li><a href="#settlement-classification-data" id="toc-settlement-classification-data" class="nav-link" data-scroll-target="#settlement-classification-data">Settlement classification data</a></li>
  <li><a href="#administrative-unit-boundaries" id="toc-administrative-unit-boundaries" class="nav-link" data-scroll-target="#administrative-unit-boundaries">Administrative Unit Boundaries</a></li>
  </ul></li>
  <li><a href="#data-processing" id="toc-data-processing" class="nav-link" data-scroll-target="#data-processing">Data Processing</a>
  <ul>
  <li><a href="#preparation-of-input-files-for-ghs-pop-based-sampling-frames" id="toc-preparation-of-input-files-for-ghs-pop-based-sampling-frames" class="nav-link" data-scroll-target="#preparation-of-input-files-for-ghs-pop-based-sampling-frames">Preparation of input files for GHS-POP based sampling frames</a></li>
  <li><a href="#preparation-of-input-files-for-worldpop-based-sampling-frames" id="toc-preparation-of-input-files-for-worldpop-based-sampling-frames" class="nav-link" data-scroll-target="#preparation-of-input-files-for-worldpop-based-sampling-frames">Preparation of input files for WorldPop based sampling frames</a></li>
  </ul></li>
  <li><a href="#gridez-sampling-frame-generation" id="toc-gridez-sampling-frame-generation" class="nav-link" data-scroll-target="#gridez-sampling-frame-generation">gridEZ: sampling frame generation</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Tutorial 2: applying gridEZ to different population datasets</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Claire Dooley <a href="mailto:c.dooley@ucl.ac.uk" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Centre for Advanced Spatial Analysis, University College London
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  


</header>


<p><strong>Suggested citation:</strong> Dooley, C.A. (2025). gridEZ Tutorial 2 version 1.0</p>
<section id="tutorial-aim" class="level2">
<h2 class="anchored" data-anchor-id="tutorial-aim">Tutorial Aim</h2>
<p>The aim of this tutorial is to generate and compare bespoke gridded sampling frames for Samoa based on different gridded population datasets. Comparisons will be made for three different target Enumeration Zone (EZ) population sizes.</p>
<p>If you are not familiar with the <code>gridEZ</code> function, we recommend that you go through Tutorial 1 first where the outputs and their features are explained in detail.</p>
</section>
<section id="packages" class="level2">
<h2 class="anchored" data-anchor-id="packages">Packages</h2>
<p>Load all the R packages necessary to complete this tutorial. If you have not yet installed the <code>gridEZ2</code> package, please follow the instructions on the Tutorial Overview page.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># list of required packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>required_packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sf"</span>, <span class="st">"terra"</span>, <span class="st">"parallel"</span>, <span class="st">"data.table"</span>, <span class="st">"ggplot2"</span>, <span class="st">"scico"</span>, <span class="st">"patchwork"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># install missing packages</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">setdiff</span>(required_packages, <span class="fu">installed.packages</span>()[, <span class="st">"Package"</span>]))</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parallel)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scico)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">#library(patchwork)</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridEZ2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="datasets" class="level2">
<h2 class="anchored" data-anchor-id="datasets">Datasets</h2>
<p>In this tutorial, we read in datasets from a folder called “data_wsm”<em>.</em> The code below checks whether you have the folder already. If you don’t, the code will create it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check your working directory</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># you may need to change your working directory to point to the location where the data_wsm folder sits. Use setwd() to change your working directory if needed</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># check whether the data folder already exists - if not, create the folder </span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">getwd</span>(),<span class="st">"/data_wsm/"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">paste0</span>(file_path))) {</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(file_path)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="population-counts-data" class="level3">
<h3 class="anchored" data-anchor-id="population-counts-data">Population counts data</h3>
<p>We will use two different datasets fro creating sampling frames: GHS-POP and WorldPop (which we also used in Tutorial 1).</p>
<section id="ghs-pop" class="level4">
<h4 class="anchored" data-anchor-id="ghs-pop">GHS-POP</h4>
<p>We will use Global Human Settlement Layer Population Grid data (GHS-POP) <span class="citation" data-cites="pesaresi2024">(<a href="#ref-pesaresi2024" role="doc-biblioref">Pesaresi et al. 2024</a>)</span>. To download the data, go to the GHS-POP website: <a href="https://human-settlement.emergency.copernicus.eu/download.php?ds=pop" class="uri">https://human-settlement.emergency.copernicus.eu/download.php?ds=pop</a></p>
<p>First, select the following options on the left hand side:</p>
<ul>
<li><p>Epoch = 2025</p></li>
<li><p>Resolution = 100m</p></li>
<li><p>Coord. system = Mollweide</p></li>
</ul>
<p>Second, hover your cursor over the map until you find Tile ID: R11_C2 (the Tile ID is written under the map). Click the tile to download. Unzip the data and add to the data folder called “data_wsm”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>popghs_raster <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">paste0</span>(<span class="fu">getwd</span>(),<span class="st">"/data_wsm/GHS_POP_E2025_GLOBE_R2023A_54009_100_V1_0_R11_C2/GHS_POP_E2025_GLOBE_R2023A_54009_100_V1_0_R11_C2.tif"</span>))</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(popghs_raster,<span class="at">main=</span><span class="st">"Population distribution of Samoa &amp; wider area (GHS-POP data)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gridEZ_tutorial2_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As you can see the GHS-POP tile covers a large area. We will crop this data later in the tutorial!</p>
</section>
<section id="worldpop" class="level4">
<h4 class="anchored" data-anchor-id="worldpop">WorldPop</h4>
<p>If you have completed Tutorial 1 skip the rest of this datasets section.</p>
<p>We will use WorldPop’s population counts data <span class="citation" data-cites="bondarenko2025">(<a href="#ref-bondarenko2025" role="doc-biblioref">Bondarenko M. 2025</a>)</span>. This global dataset has spatial resolution of 3 arc (approximately 100m at the equator) and has population constrained to grid cells that contain settlement. We will use the data for Samoa with estimated population counts for 2025 (alpha version: R2025A version v1).</p>
<p>More information about the dataset can be found here: <a href="https://hub.worldpop.org/geodata/summary?id=76095" class="uri">https://hub.worldpop.org/geodata/summary?id=76095</a></p>
<p>You can read in the data directly from the WorldPop server or you can download the data via the link above and then read the data into R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 1: read in directly from WP server</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>popwp_raster<span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"https://data.worldpop.org/GIS/Population/Global_2015_2030/R2025A/2025/WSM/v1/100m/constrained/wsm_pop_2025_CN_100m_R2025A_v1.tif"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 2: read in from file after download</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>popwp_raster<span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">paste0</span>(<span class="fu">getwd</span>(),<span class="st">"/data_wsm/wsm_pop_2025_CN_100m_R2025A_v1.tif"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(popwp_raster,<span class="at">main=</span><span class="st">"Population distribution of Samoa (WorldPop data)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gridEZ_tutorial2_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="settlement-classification-data" class="level3">
<h3 class="anchored" data-anchor-id="settlement-classification-data">Settlement classification data</h3>
<p>We will use Global Human Settlement Layer Settlement Model data (GHS-SMOD) <span class="citation" data-cites="pesaresi2024 schiavina2023">(<a href="#ref-pesaresi2024" role="doc-biblioref">Pesaresi et al. 2024</a>; <a href="#ref-schiavina2023" role="doc-biblioref">Schiavina, Melchiorri, and Pesaresi 2023</a>)</span>. To download the data, go to the GHS-SMOD website: <a href="https://human-settlement.emergency.copernicus.eu/download.php?ds=smod" class="uri">https://human-settlement.emergency.copernicus.eu/download.php?ds=smod</a></p>
<p>First, select the following options on the left hand side:</p>
<ul>
<li><p>Epoch = 2025</p></li>
<li><p>Resolution = 1km</p></li>
<li><p>Coord. system = Mollweide</p></li>
</ul>
<p>Second, hover your cursor over the map until you find Tile ID: R11_C2 (the Tile ID is written under the map). Click the tile to download. Unzip the data and add to the data folder called “data_wsm”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>settlement_raster <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">paste0</span>(<span class="fu">getwd</span>(),<span class="st">"/data_wsm/GHS_SMOD_E2025_GLOBE_R2023A_54009_1000_V2_0_R11_C2/GHS_SMOD_E2025_GLOBE_R2023A_54009_1000_V2_0_R11_C2.tif"</span>))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(settlement_raster,<span class="at">main=</span><span class="st">"Settlement categories of Samoa &amp; wider area (GHS-SMOD data)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gridEZ_tutorial2_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The GHS-SMOD tile covers the same area as the GHS-POP. We will crop both datasets in the Data Processing section.</p>
</section>
<section id="administrative-unit-boundaries" class="level3">
<h3 class="anchored" data-anchor-id="administrative-unit-boundaries">Administrative Unit Boundaries</h3>
<p>For the administrative boundaries, we’ll use GADM as it has global coverage and has fully harmonized boundaries <span class="citation" data-cites="GADM2022">(<a href="#ref-GADM2022" role="doc-biblioref">GADM 2022</a>)</span>. Download GADM boundaries here by selecting Samoa from the drop down and then clicking “Shapefile”: <a href="https://gadm.org/download_country.html" class="uri">https://gadm.org/download_country.html</a></p>
<p>We use version 4.1 of the GADM data. If you prefer to use a different version, you can simply edit the file name in the <code>sf::st_read</code> code below. Unzip and add the shapefile to your data_wsm folder.</p>
<p>Read in level 2 administrative units.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>admin_sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="fu">paste0</span>(<span class="fu">getwd</span>(),<span class="st">"/data_WSM/gadm41_WSM_shp/gadm41_WSM_2.shp"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `gadm41_WSM_2' from data source 
  `/Users/clairedooley/Documents/Research/gridEZ/gridEZ_tutorials/data_wsm/gadm41_WSM_shp/gadm41_WSM_2.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 43 features and 13 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -172.8041 ymin: -14.07722 xmax: -171.3977 ymax: -13.43981
Geodetic CRS:  WGS 84</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># look at the list of fields in admin_sf</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(admin_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "GID_2"     "GID_0"     "COUNTRY"   "GID_1"     "NAME_1"    "NL_NAME_1"
 [7] "NAME_2"    "VARNAME_2" "NL_NAME_2" "TYPE_2"    "ENGTYPE_2" "CC_2"     
[13] "HASC_2"    "geometry" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the "GID_2" field which contains the level 2 unit IDs</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(admin_sf[<span class="st">"GID_2"</span>],<span class="at">main=</span><span class="st">"Level 2 administrative units for Samoa (GADM data)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gridEZ_tutorial2_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="data-processing" class="level2">
<h2 class="anchored" data-anchor-id="data-processing">Data Processing</h2>
<p>The two population datasets are in different coordinate reference systems (CRS). To preserve the original population estimates in each dataset, we’ll prepare two sets of <code>gridEZ</code> input files - one for each CRS.</p>
<p>Before doing so, however, there is a processing step common to both sets of inputs so we can do that first.</p>
<p>In Tutorial 1, we briefly discussed the GHS-SMOD settlement categories. As there are often single grid cells of one category surrounded by cells of other categories - an undesirable situation when defining sampling frame strata - we merge the categories into just two. If you would like more details on this, you can look back at Tutorial 1. Here, we will go ahead with the re-categorization into one urban category and one rural category.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># re-define categories</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>settlement_raster[settlement_raster <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">30</span>,<span class="dv">23</span>,<span class="dv">22</span>,<span class="dv">21</span>)] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># urban</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>settlement_raster[settlement_raster <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">13</span>,<span class="dv">12</span>,<span class="dv">11</span>)] <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="co"># rural</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>settlement_raster[settlement_raster <span class="sc">==</span> <span class="dv">10</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span> <span class="co">#water</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="preparation-of-input-files-for-ghs-pop-based-sampling-frames" class="level3">
<h3 class="anchored" data-anchor-id="preparation-of-input-files-for-ghs-pop-based-sampling-frames">Preparation of input files for GHS-POP based sampling frames</h3>
<p>We already know that the GHS-POP and GHS-SMOD data are in a Mollweide CRS as we selected this when downloading. As we need all input data to be in the same CRS, the next step is to check and, if needed, transform the CRS of the administrative units data.</p>
<p>To distinguish between our two sets of input data, we’ll add MW to the names of object we create in a Mollweide CRS.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># change name of pop raster</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>popghsMW_raster <span class="ot">&lt;-</span> popghs_raster</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(popghs_raster)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># identify the CRS of the population raster</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>r_crs <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">crs</span>(popghsMW_raster)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># if the admin layer is in a different CRS, transform</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(r_crs <span class="sc">!=</span>sf<span class="sc">::</span><span class="fu">st_crs</span>(admin_sf)){adminMW_sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(admin_sf, r_crs)}</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co"># re-plot the admin boundaries in their new crs</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(adminMW_sf[<span class="st">"GID_2"</span>],<span class="at">main=</span><span class="st">"Level 2 administrative units for Samoa (GADM data)"</span>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">"CRS = Mollweide"</span>,<span class="at">side=</span><span class="dv">3</span>,<span class="at">line=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gridEZ_tutorial2_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now, let’s crop the GHS-POP and GHS-SMOD data to include just Samoa.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># crop </span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># we need to obtain a "SpatExtent" object containing our desired extent for this</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>adminMW_vect <span class="ot">&lt;-</span> <span class="fu">vect</span>(adminMW_sf)      <span class="co"># convert sf to SpatVector</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>adminMW_ext <span class="ot">&lt;-</span> <span class="fu">ext</span>(adminMW_vect)      <span class="co"># extract SpatExtent</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># use the "SpatExtent" to crop GHS-POP &amp; GHS-SMOD</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>popghsMW_raster <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">crop</span>(popghsMW_raster,adminMW_ext,<span class="at">snap=</span><span class="st">"out"</span>,<span class="at">extend=</span><span class="cn">TRUE</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>settMW_raster <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">crop</span>(settlement_raster,adminMW_ext,<span class="at">snap=</span><span class="st">"out"</span>,<span class="at">extend=</span><span class="cn">TRUE</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the pop raster to check the new extent</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(popghsMW_raster,<span class="at">main=</span><span class="st">"Population distribution of Samoa (GHS-POP data)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gridEZ_tutorial2_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Great - we have cropped the population and settlement layers to the correct area. From the map, it looks like there may be some buffering around the island landmasses with non-NA population values. This is fine as <code>gridEZ</code> only creates EZs where (non-NA) values for population and both strata exist. So as long as we have non-NA values everywhere inside our administrative unit boundaries and NAs values outside for at least one dataset, we know that EZs will not be constructed outside the national border.</p>
<p>To do this, we can create a rasterized version of the administrative units with each grid cell value reflecting the level 2 administrative unit they fall within. We rasterize the administrative units based on the grid of the population raster.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rasterize admin_sf </span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>adminMW_raster <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rasterize</span>(adminMW_sf,popghsMW_raster,<span class="at">field=</span><span class="st">"GID_2"</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># remove admin_sf object as we no long need it</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(adminMW_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The last step needed before we can save this set of input rasters is to increase the spatial resolution of the settlement raster to match the population and administrative unit rasters. We do this using the <code>terra::resample</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>settMW_raster <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">resample</span>(settMW_raster, popghsMW_raster, <span class="at">method =</span> <span class="st">"near"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, save the three rasters into a folder called “made” inside your “data_wsm” folder.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check whether the "made" folder already exists - if not, create the folder </span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">getwd</span>(),<span class="st">"/data_wsm/made/"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">paste0</span>(file_path))) {</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(file_path)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># save rasters</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">writeRaster</span>(adminMW_raster,<span class="fu">paste0</span>(file_path,<span class="st">"adminMW.tif"</span>))</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">writeRaster</span>(popghsMW_raster,<span class="fu">paste0</span>(file_path,<span class="st">"popghsMW.tif"</span>))</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">writeRaster</span>(settMW_raster,<span class="fu">paste0</span>(file_path,<span class="st">"settMW.tif"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="preparation-of-input-files-for-worldpop-based-sampling-frames" class="level3">
<h3 class="anchored" data-anchor-id="preparation-of-input-files-for-worldpop-based-sampling-frames">Preparation of input files for WorldPop based sampling frames</h3>
<p>As above, the first processing step is to get all datasets in the same CRS. To preserve the quality of the population estimates we do not want to reproject the population raster. Instead we check and, where needed, transform the other two datasets.</p>
<p>Let’s check the CRS of the population data first.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># identify the CRS of the population raster</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>r_crs <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">crs</span>(popwp_raster)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>r_crs <span class="co"># print out the crs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "GEOGCRS[\"WGS 84\",\n    ENSEMBLE[\"World Geodetic System 1984 ensemble\",\n        MEMBER[\"World Geodetic System 1984 (Transit)\"],\n        MEMBER[\"World Geodetic System 1984 (G730)\"],\n        MEMBER[\"World Geodetic System 1984 (G873)\"],\n        MEMBER[\"World Geodetic System 1984 (G1150)\"],\n        MEMBER[\"World Geodetic System 1984 (G1674)\"],\n        MEMBER[\"World Geodetic System 1984 (G1762)\"],\n        MEMBER[\"World Geodetic System 1984 (G2139)\"],\n        MEMBER[\"World Geodetic System 1984 (G2296)\"],\n        ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n            LENGTHUNIT[\"metre\",1]],\n        ENSEMBLEACCURACY[2.0]],\n    PRIMEM[\"Greenwich\",0,\n        ANGLEUNIT[\"degree\",0.0174532925199433]],\n    CS[ellipsoidal,2],\n        AXIS[\"geodetic latitude (Lat)\",north,\n            ORDER[1],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n        AXIS[\"geodetic longitude (Lon)\",east,\n            ORDER[2],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n    USAGE[\n        SCOPE[\"Horizontal component of 3D system.\"],\n        AREA[\"World.\"],\n        BBOX[-90,-180,90,180]],\n    ID[\"EPSG\",4326]]"</code></pre>
</div>
</div>
<p>The WorldPop population data are in a World Geodetic System 1984 projection. We can include “WGS” in the names of data objects to distinguish from the previous objects we created that were in a Mollweide project. OK, let’s go ahead and get all our data in the same CRS.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># change name of pop raster to indicate its crs</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>popwpWGS_raster <span class="ot">&lt;-</span> popwp_raster</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(popwp_raster)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># if the other layers have a different CRS, transform</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(r_crs <span class="sc">!=</span>sf<span class="sc">::</span><span class="fu">st_crs</span>(admin_sf)){adminWGS_sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(admin_sf, r_crs)}</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(r_crs <span class="sc">!=</span>terra<span class="sc">::</span><span class="fu">crs</span>(settlement_raster)){settWGS_raster <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">project</span>(settlement_raster,terra<span class="sc">::</span><span class="fu">crs</span>(popwpWGS_raster),<span class="at">method=</span><span class="st">"near"</span>)}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we need to convert the sf object containing administrative units into a raster. We do this using the grid of the population raster.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rasterize admin_sf</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>adminWGS_raster <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rasterize</span>(adminWGS_sf,popwpWGS_raster,<span class="at">field=</span><span class="st">"GID_2"</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># remove admin_sf object as we no long need it</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(adminWGS_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this tutorial, we want to generate sampling frames the cover the whole area of Samoa. As the <code>gridEZ</code> function will include all grid cells that have non-NA values across the input datasets, we convert all NA population values inside the national boundary with 0s.</p>
<p>If you are interested in creating sampling frames for areas constrained to settlements, please check out Tutorial X.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># replace grid cells of NA population counts that also have non-NA administrative unit values with 0 counts</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>popwpWGS_raster[<span class="fu">is.na</span>(popwpWGS_raster)<span class="sc">&amp;!</span><span class="fu">is.na</span>(adminWGS_raster)] <span class="ot">&lt;-</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we crop the settlement raster to the extent of the administrative units and population rasters.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># crop </span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>settWGS_raster <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">crop</span>(settWGS_raster,adminWGS_raster,<span class="at">snap=</span><span class="st">"out"</span>,<span class="at">extend=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we have all three rasters in the same CRS and with the same extents.</p>
<p>Finally, we increase the spatial resolution of the settlement raster to match the population and administrative unit rasters.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>settWGS_raster <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">resample</span>(settWGS_raster, popwpWGS_raster, <span class="at">method =</span> <span class="st">"near"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We are ready to save our rasters!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save rasters</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">writeRaster</span>(adminWGS_raster,<span class="fu">paste0</span>(file_path,<span class="st">"adminWGS.tif"</span>))</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">writeRaster</span>(popwpWGS_raster,<span class="fu">paste0</span>(file_path,<span class="st">"popwpWGS.tif"</span>))</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">writeRaster</span>(settWGS_raster,<span class="fu">paste0</span>(file_path,<span class="st">"settWGS.tif"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="gridez-sampling-frame-generation" class="level2">
<h2 class="anchored" data-anchor-id="gridez-sampling-frame-generation">gridEZ: sampling frame generation</h2>
<p>We will create three sampling frames for each population dataset - one with small EZs, one with medium EZs and one with large EZs.</p>
<p><code>gridEZ</code> utilises parallel processing to generate EZs for different strata at the same time. You can set the number of parallel jobs you would like to run using the following code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove all objects</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>()</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># garbage collection</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">gc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          used (Mb) gc trigger  (Mb) limit (Mb) max used (Mb)
Ncells 1671739 89.3    3112111 166.3         NA  3107720  166
Vcells 2494366 19.1    8388608  64.0      36864  8388608   64</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># total number of cores available on your computer</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>parallel<span class="sc">::</span><span class="fu">detectCores</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 14</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we advise that you use your total number of cores minus 1 but you could use fewer (unless you only acces to one core, then you should specify 1 processing core) </span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>processing_cores <span class="ot">&lt;-</span> <span class="fu">max</span>(parallel<span class="sc">::</span><span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>processing_cores</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13</code></pre>
</div>
</div>
<p>Next set the file pathways for input and output files.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># input</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>file_path_inputs <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">getwd</span>(),<span class="st">"/data_wsm/made/"</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># output</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># check whether the output folder already exists - if not, create the folder </span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>file_path_outputs_tuts <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">getwd</span>(),<span class="st">"/results_wsm/"</span>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">paste0</span>(file_path_outputs_tuts))) {</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(file_path_outputs_tuts)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>file_path_outputs <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">getwd</span>(),<span class="st">"/results_wsm/tutorial2/"</span>)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">paste0</span>(file_path_outputs))) {</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(file_path_outputs)</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can create our sampling frames. We’ll change <code>run_ID</code> for each new run of the <code>gridEZ</code> function. Each run may take a minute or so depending on your computing system.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># GHS-POP pop ests, small EZs</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>gridEZ2<span class="sc">::</span><span class="fu">gridEZ</span>(<span class="at">population_raster_path =</span> <span class="fu">paste0</span>(file_path_inputs,<span class="st">"popghsMW.tif"</span>), </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">strata1_raster_path =</span> <span class="fu">paste0</span>(file_path_inputs,<span class="st">"adminMW.tif"</span>), </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">strata2_raster_path =</span> <span class="fu">paste0</span>(file_path_inputs,<span class="st">"settMW.tif"</span>),</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">predefined_EZ_size =</span> <span class="cn">TRUE</span>, </span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">EZ_target_size =</span> <span class="st">"small"</span>,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">output_path =</span> <span class="fu">paste0</span>(file_path_outputs), </span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">run_ID =</span> <span class="st">"wsm_ghs_small"</span>,</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">ncores=</span>processing_cores)</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="co"># GHS-POP pop ests, medium EZs</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>gridEZ2<span class="sc">::</span><span class="fu">gridEZ</span>(<span class="at">population_raster_path =</span> <span class="fu">paste0</span>(file_path_inputs,<span class="st">"popghsMW.tif"</span>), </span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">strata1_raster_path =</span> <span class="fu">paste0</span>(file_path_inputs,<span class="st">"adminMW.tif"</span>), </span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">strata2_raster_path =</span> <span class="fu">paste0</span>(file_path_inputs,<span class="st">"settMW.tif"</span>),</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">predefined_EZ_size =</span> <span class="cn">TRUE</span>, </span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">EZ_target_size =</span> <span class="st">"medium"</span>,</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">output_path =</span> <span class="fu">paste0</span>(file_path_outputs), </span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>                <span class="at">run_ID =</span> <span class="st">"wsm_ghs_med"</span>,</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>                <span class="at">ncores=</span>processing_cores)</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="co"># GHS-POP pop ests, large EZs</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>gridEZ2<span class="sc">::</span><span class="fu">gridEZ</span>(<span class="at">population_raster_path =</span> <span class="fu">paste0</span>(file_path_inputs,<span class="st">"popghsMW.tif"</span>), </span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>                <span class="at">strata1_raster_path =</span> <span class="fu">paste0</span>(file_path_inputs,<span class="st">"adminMW.tif"</span>), </span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>                <span class="at">strata2_raster_path =</span> <span class="fu">paste0</span>(file_path_inputs,<span class="st">"settMW.tif"</span>),</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>                <span class="at">predefined_EZ_size =</span> <span class="cn">TRUE</span>, </span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>                <span class="at">EZ_target_size =</span> <span class="st">"large"</span>,</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>                <span class="at">output_path =</span> <span class="fu">paste0</span>(file_path_outputs), </span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>                <span class="at">run_ID =</span> <span class="st">"wsm_ghs_large"</span>,</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>                <span class="at">ncores=</span>processing_cores)</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a><span class="co"># WP pop ests, small EZs</span></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>gridEZ2<span class="sc">::</span><span class="fu">gridEZ</span>(<span class="at">population_raster_path =</span> <span class="fu">paste0</span>(file_path_inputs,<span class="st">"popwpWGS.tif"</span>), </span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>                <span class="at">strata1_raster_path =</span> <span class="fu">paste0</span>(file_path_inputs,<span class="st">"adminWGS.tif"</span>), </span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>                <span class="at">strata2_raster_path =</span> <span class="fu">paste0</span>(file_path_inputs,<span class="st">"settWGS.tif"</span>),</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>                <span class="at">predefined_EZ_size =</span> <span class="cn">TRUE</span>, </span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>                <span class="at">EZ_target_size =</span> <span class="st">"small"</span>,</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>                <span class="at">output_path =</span> <span class="fu">paste0</span>(file_path_outputs), </span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>                <span class="at">run_ID =</span> <span class="st">"wsm_wp_small"</span>,</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>                <span class="at">ncores=</span>processing_cores)</span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a><span class="co"># WP pop ests, medium EZs</span></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>gridEZ2<span class="sc">::</span><span class="fu">gridEZ</span>(<span class="at">population_raster_path =</span> <span class="fu">paste0</span>(file_path_inputs,<span class="st">"popwpWGS.tif"</span>), </span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>                <span class="at">strata1_raster_path =</span> <span class="fu">paste0</span>(file_path_inputs,<span class="st">"adminWGS.tif"</span>), </span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a>                <span class="at">strata2_raster_path =</span> <span class="fu">paste0</span>(file_path_inputs,<span class="st">"settWGS.tif"</span>),</span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a>                <span class="at">predefined_EZ_size =</span> <span class="cn">TRUE</span>, </span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a>                <span class="at">EZ_target_size =</span> <span class="st">"medium"</span>,</span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a>                <span class="at">output_path =</span> <span class="fu">paste0</span>(file_path_outputs), </span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a>                <span class="at">run_ID =</span> <span class="st">"wsm_wp_med"</span>,</span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a>                <span class="at">ncores=</span>processing_cores)</span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a><span class="co"># WP pop ests, large EZs</span></span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a>gridEZ2<span class="sc">::</span><span class="fu">gridEZ</span>(<span class="at">population_raster_path =</span> <span class="fu">paste0</span>(file_path_inputs,<span class="st">"popwpWGS.tif"</span>), </span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true" tabindex="-1"></a>                <span class="at">strata1_raster_path =</span> <span class="fu">paste0</span>(file_path_inputs,<span class="st">"adminWGS.tif"</span>), </span>
<span id="cb34-54"><a href="#cb34-54" aria-hidden="true" tabindex="-1"></a>                <span class="at">strata2_raster_path =</span> <span class="fu">paste0</span>(file_path_inputs,<span class="st">"settWGS.tif"</span>),</span>
<span id="cb34-55"><a href="#cb34-55" aria-hidden="true" tabindex="-1"></a>                <span class="at">predefined_EZ_size =</span> <span class="cn">TRUE</span>, </span>
<span id="cb34-56"><a href="#cb34-56" aria-hidden="true" tabindex="-1"></a>                <span class="at">EZ_target_size =</span> <span class="st">"large"</span>,</span>
<span id="cb34-57"><a href="#cb34-57" aria-hidden="true" tabindex="-1"></a>                <span class="at">output_path =</span> <span class="fu">paste0</span>(file_path_outputs), </span>
<span id="cb34-58"><a href="#cb34-58" aria-hidden="true" tabindex="-1"></a>                <span class="at">run_ID =</span> <span class="st">"wsm_wp_large"</span>,</span>
<span id="cb34-59"><a href="#cb34-59" aria-hidden="true" tabindex="-1"></a>                <span class="at">ncores=</span>processing_cores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great - now we can look at the results!</p>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<p>The <code>gridEZ</code> function produces two output files:</p>
<ul>
<li><p>.csv with file name beginning “EZ_Pop_Ncells_”. Tabular results for EZs within the sampling frame.</p></li>
<li><p>.tif (raster) with file name beginning “EZ_IDs_”. Raster of the sampling frame.</p></li>
</ul>
<p>One way to evaluate <code>gridEZ</code> sampling frames is to categorize EZs based on how well their population and geographic size meet the sampling frame criteria. All the information we need to do this is reported in the .csv file. We also convert the raster into polygons so that we can easily map out the EZ categorizations. The categories we use:</p>
<ul>
<li><p>Category 1: within ideal population range and not geographically too large</p></li>
<li><p>Category 2: low population but within the maximum geographic size range for sparsely populated areas</p></li>
<li><p>Category 3: single cell EZ with high population</p></li>
<li><p>Category 4: high population, contains more than 1 cell but does not exceed the acceptable maximum geographic size</p></li>
<li><p>Category 5: population and geographic size are too low</p></li>
<li><p>Category 6: exceeds the acceptable maximum geographic size</p></li>
</ul>
<p>Category 1 includes EZs with ideal characteristics (within the gridded data framework). Categories 2 and 3 contain EZs with acceptable characteristics given the population distribution. Categories 4, 5 and 6 include EZs with undesirable characteristics due to:</p>
<ul>
<li><p>landscape restrictions, e.g.&nbsp;tiny islands (category 5)</p></li>
<li><p>data restrictions, e.g.&nbsp;stratum contains tiny area (category 5)</p></li>
<li><p>trade off between compactness and size of EZ (categories 4-6)</p></li>
</ul>
<p>Further explanation and examples for these categories can be found in Tutorial 1.</p>
<p>OK - let’s evaluates the 6 sampling frames we have generated in this tutorial. First, we need to create a table with the threshold values based on the criteria applied to generate our sampling frames.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># table of threshold values for diff. size EZs</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>thresholds_tab <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">data.table</span>( <span class="at">popdata=</span><span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"wp"</span>,<span class="st">"ghs"</span>),<span class="at">each=</span><span class="dv">3</span>), <span class="at">EZsize=</span><span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"small"</span>,<span class="st">"med"</span>,<span class="st">"large"</span>),<span class="dv">2</span>), <span class="at">minpop=</span><span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">50</span>,<span class="dv">333</span>,<span class="dv">800</span>),<span class="dv">2</span>), <span class="at">maxpop=</span><span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">100</span>,<span class="dv">667</span>,<span class="dv">1600</span>),<span class="dv">2</span>), <span class="at">lowermaxgeog=</span><span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">75</span>,<span class="dv">675</span>,<span class="dv">1875</span>),<span class="dv">2</span>), <span class="at">uppermaxgeog=</span><span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">150</span>,<span class="dv">1350</span>,<span class="dv">3750</span>),<span class="dv">2</span>) )</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>thresholds_tab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   popdata EZsize minpop maxpop lowermaxgeog uppermaxgeog
    &lt;char&gt; &lt;char&gt;  &lt;num&gt;  &lt;num&gt;        &lt;num&gt;        &lt;num&gt;
1:      wp  small     50    100           75          150
2:      wp    med    333    667          675         1350
3:      wp  large    800   1600         1875         3750
4:     ghs  small     50    100           75          150
5:     ghs    med    333    667          675         1350
6:     ghs  large    800   1600         1875         3750</code></pre>
</div>
</div>
<p>The next section of code categorizes each EZ in each of our sampling frames and then creates a summary table of the results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># list of all files in output folder</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>file_list <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="fu">paste0</span>(file_path_outputs),<span class="at">full.names =</span> <span class="cn">TRUE</span>) </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co"># subset to outputs saved above</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>file_list <span class="ot">&lt;-</span> file_list[<span class="fu">grepl</span>(<span class="st">"wsm_wp|wsm_ghs"</span>, file_list)] </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co"># categorise EZs based on their pop &amp; geog</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>res_poly_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">split</span>(thresholds_tab, <span class="fu">seq_len</span>(<span class="fu">nrow</span>(thresholds_tab))),<span class="cf">function</span>(x){</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># read in summary table of sampling frame</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  file_name <span class="ot">&lt;-</span> file_list[<span class="fu">grepl</span>(<span class="fu">paste</span>(x<span class="sc">$</span>popdata), file_list) <span class="sc">&amp;</span> <span class="fu">grepl</span>(<span class="fu">paste</span>(x<span class="sc">$</span>EZsize), file_list) <span class="sc">&amp;</span> <span class="fu">grepl</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">.csv$"</span>, file_list)]</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  EZ_tab <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste</span>(file_name),<span class="at">header=</span>T)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># read in sampling frame raster</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  file_name <span class="ot">&lt;-</span> file_list[<span class="fu">grepl</span>(<span class="fu">paste</span>(x<span class="sc">$</span>popdata), file_list) <span class="sc">&amp;</span> <span class="fu">grepl</span>(<span class="fu">paste</span>(x<span class="sc">$</span>EZsize), file_list) <span class="sc">&amp;</span> <span class="fu">grepl</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">.tif$"</span>, file_list)]</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  EZ <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">paste</span>(file_name))</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert to sf polygons</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  res_poly <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">as.polygons</span>(EZ, <span class="at">dissolve =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  res_poly <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_as_sf</span>(res_poly)</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  res_poly <span class="ot">&lt;-</span> <span class="fu">merge</span>(res_poly,EZ_tab,<span class="at">by=</span><span class="st">"EZ_ID"</span>)</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>  res_poly<span class="sc">$</span>popdata <span class="ot">&lt;-</span> x<span class="sc">$</span>popdata</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>  res_poly<span class="sc">$</span>EZsize <span class="ot">&lt;-</span> x<span class="sc">$</span>EZsize</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>  res_poly<span class="sc">$</span>cat <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>  res_poly<span class="sc">$</span>cat[res_poly<span class="sc">$</span>N<span class="sc">&lt;=</span>x<span class="sc">$</span>uppermaxgeog <span class="sc">&amp;</span> res_poly<span class="sc">$</span>pop<span class="sc">&gt;=</span>x<span class="sc">$</span>minpop <span class="sc">&amp;</span> res_poly<span class="sc">$</span>pop<span class="sc">&lt;=</span>x<span class="sc">$</span>maxpop] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>  res_poly<span class="sc">$</span>cat[res_poly<span class="sc">$</span>N<span class="sc">&gt;=</span>x<span class="sc">$</span>lowermaxgeog <span class="sc">&amp;</span> res_poly<span class="sc">$</span>N<span class="sc">&lt;=</span>x<span class="sc">$</span>uppermaxgeog <span class="sc">&amp;</span> res_poly<span class="sc">$</span>pop<span class="sc">&lt;</span>x<span class="sc">$</span>minpop] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>  res_poly<span class="sc">$</span>cat[res_poly<span class="sc">$</span>N<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> res_poly<span class="sc">$</span>pop<span class="sc">&gt;</span>x<span class="sc">$</span>maxpop] <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>  res_poly<span class="sc">$</span>cat[res_poly<span class="sc">$</span>N<span class="sc">&gt;</span><span class="dv">1</span> <span class="sc">&amp;</span> res_poly<span class="sc">$</span>pop<span class="sc">&gt;</span>x<span class="sc">$</span>maxpop] <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>  res_poly<span class="sc">$</span>cat[res_poly<span class="sc">$</span>N<span class="sc">&lt;</span>x<span class="sc">$</span>lowermaxgeog <span class="sc">&amp;</span> res_poly<span class="sc">$</span>pop<span class="sc">&lt;</span>x<span class="sc">$</span>minpop] <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>  res_poly<span class="sc">$</span>cat[res_poly<span class="sc">$</span>N<span class="sc">&gt;</span>x<span class="sc">$</span>uppermaxgeog] <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>  res_poly</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a><span class="co"># count occurrences of each category value, filling missing cats with zeros</span></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>all_cats <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>count_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(res_poly_list, <span class="cf">function</span>(res_poly) {</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>  counts <span class="ot">&lt;-</span> res_poly <span class="sc">%&gt;%</span></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">count</span>(cat)</span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to named vector, fill in missing cats with 0</span></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>    count_vec <span class="ot">&lt;-</span> <span class="fu">setNames</span>(counts<span class="sc">$</span>n, counts<span class="sc">$</span>cat)</span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>    full_vec <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(all_cats)), all_cats)</span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>    full_vec[<span class="fu">names</span>(count_vec)] <span class="ot">&lt;-</span> count_vec</span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>    prop_vec <span class="ot">&lt;-</span> <span class="fu">round</span>((full_vec<span class="sc">/</span><span class="fu">sum</span>(full_vec))<span class="sc">*</span><span class="dv">100</span>,<span class="dv">1</span>)</span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(prop_vec) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"perc"</span>, all_cats)</span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a>    data.table<span class="sc">::</span><span class="fu">data.table</span>(<span class="at">popdata=</span>res_poly<span class="sc">$</span>popdata[<span class="dv">1</span>],<span class="at">EZsize=</span>res_poly<span class="sc">$</span>EZsize[<span class="dv">1</span>],<span class="at">nEZ=</span><span class="fu">sum</span>(full_vec),<span class="fu">t</span>(full_vec),<span class="fu">t</span>(prop_vec))</span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a><span class="co"># rbind above count_list object into a table</span></span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a>summary_tab <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, count_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The summary table contains both counts of EZs in each category as well as percentages of EZs in each category, for each sampling frame. Let’s look at the counts first.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(summary_tab) <span class="co"># use to know which columns to select in next line</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "popdata" "EZsize"  "nEZ"     "1"       "2"       "3"       "4"      
 [8] "5"       "6"       "perc1"   "perc2"   "perc3"   "perc4"   "perc5"  
[15] "perc6"  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>summary_tab[,<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>] <span class="co"># counts of EZs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   popdata EZsize   nEZ     1     2     3     4     5     6
    &lt;char&gt; &lt;char&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;
1:      wp  small  5760  2597  2721     0   113   329     0
2:      wp    med   743   421   256     0    13    52     1
3:      wp  large   305   169    83     0     5    48     0
4:     ghs  small  5452  2317  2275    24   283   552     1
5:     ghs    med   741   433   220     0    13    73     2
6:     ghs  large   322   187    64     0     1    70     0</code></pre>
</div>
</div>
<p>Now, percentages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>summary_tab[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">10</span><span class="sc">:</span><span class="dv">15</span>)] <span class="co"># percentage of EZs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   popdata EZsize   nEZ perc1 perc2 perc3 perc4 perc5 perc6
    &lt;char&gt; &lt;char&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;
1:      wp  small  5760  45.1  47.2   0.0   2.0   5.7   0.0
2:      wp    med   743  56.7  34.5   0.0   1.7   7.0   0.1
3:      wp  large   305  55.4  27.2   0.0   1.6  15.7   0.0
4:     ghs  small  5452  42.5  41.7   0.4   5.2  10.1   0.0
5:     ghs    med   741  58.4  29.7   0.0   1.8   9.9   0.3
6:     ghs  large   322  58.1  19.9   0.0   0.3  21.7   0.0</code></pre>
</div>
</div>
<p>Across all sampling frames, the majory of EZs fall into categories 1 and 2. The number of EZs falling within category 3 (single cell, high population EZs) is really dependent on population density versus the target population per EZ criterion. In countries with lots of very densely populated areas, we would expect to see lots of EZs in category 3. The only sampling frame containing category 3 EZs in our set of 6, is the one based on GHS-POP with “small” EZ criteria. The results in our summary table tell us that there are 24 GHS-POP grid cells with population counts over 100 people.</p>
<p>There are relatively few EZs falling into category 4 (multi-single cell, high population EZs) and very rarely EZs falling into category 6 (exceeding the acceptable geographic maximum). Category 5 EZs (small in terms of both population and geographic size) occur between 5.7 and 21.7% across the 6 sampling frames.</p>
<p>Let’s map the two “large” EZ sampling frames, colour coded by EZ category.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># map a couple of example outputs</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co"># define the colour coding first</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>cat_cols <span class="ot">&lt;-</span> scales<span class="sc">::</span><span class="fu">hue_pal</span>()(<span class="dv">6</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plot </span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>)){</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  example_EZs <span class="ot">&lt;-</span> res_poly_list[[i]]</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  example_EZs<span class="sc">$</span>cat <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(example_EZs<span class="sc">$</span>cat)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(example_EZs[<span class="st">"cat"</span>], <span class="at">pal =</span> cat_cols, <span class="at">main=</span><span class="fu">paste</span>(<span class="st">"EZs by evaluation category ("</span>,example_EZs<span class="sc">$</span>popdata[<span class="dv">1</span>],<span class="st">"; "</span>,example_EZs<span class="sc">$</span>EZsize[<span class="dv">1</span>],<span class="st">" EZs)"</span>,<span class="at">sep=</span><span class="st">""</span>))</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gridEZ_tutorial2_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gridEZ_tutorial2_files/figure-html/unnamed-chunk-29-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>You can see that EZs across the two sampling frame show a number of similarities in terms of size, shape and category for many locations. The main obvious difference is the angle of many EZs’ boundaries and this comes from the CRS of the administrative boundaries differing.</p>
<p>The selection of administrative boundaries and settlement data will have a huge impact on the sampling frame produced by <code>gridEZ</code> as the algorithm assumes the boundaries between classifications (along grid lines) of these two input datasets is true and does not amend them under any circumstances.</p>
<p>Note that our categorization of EZs is purely to summarise the sampling frames and demonstrate that <code>gridEZ</code> is suitable for producing frames based on either population dataset. A quantitative comparison of EZ categories between sampling frames based on WorldPop data and those based on GHS-POP data does not tell you which is the better sampling frame to use. This is because to date there is no validation of the datasets against real, fine-scale enumeration which means that the quality of EZs in <code>gridEZ</code> sampling frames can not be validated either. Here, we simply evaluate how well the resulting sampling frames match up to our aim (set out by the criteria) given the input data.</p>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>This tutorial has covered:</p>
<ul>
<li><p>preparing common datasets suitable for the <code>gridEZ</code> R function</p></li>
<li><p>generating gridded sampling frames using WorldPop and GHS-POP gridded population estimates</p></li>
<li><p>summarizing output sampling frames in terms of the population and geographic size of their constituent EZs</p></li>
<li><p>evaluating sampling frame EZs</p></li>
</ul>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-bondarenko2025" class="csl-entry" role="listitem">
Bondarenko M., Tejedor-Garavito N., Priyatikanto R. 2025. <span>“Constrained Estimates of 2015-2030 Total Number of People Per Grid Square at a Resolution of 3 Arc (Approximately 100m at the Equator) R2025A Version V1.”</span> WorldPop - School of Geography; Environmental Science, University of Southampton. <a href="https://doi.org/10.5258/SOTON/WP00839">https://doi.org/10.5258/SOTON/WP00839</a>.
</div>
<div id="ref-GADM2022" class="csl-entry" role="listitem">
GADM. 2022. <span>“GADM Database of Global Administrative Areas, Version 4.1.”</span> <a href="https://gadm.org/download_country.html">https://gadm.org/download_country.html</a>.
</div>
<div id="ref-pesaresi2024" class="csl-entry" role="listitem">
Pesaresi, Martino, Marcello Schiavina, Panagiotis Politis, Sergio Freire, Katarzyna Krasnodębska, Johannes H. Uhl, Alessandra Carioli, et al. 2024. <span>“Advances on the Global Human Settlement Layer by Joint Assessment of Earth Observation and Population Survey Data.”</span> <em>International Journal of Digital Earth</em> 17 (1). <a href="https://doi.org/10.1080/17538947.2024.2390454">https://doi.org/10.1080/17538947.2024.2390454</a>.
</div>
<div id="ref-schiavina2023" class="csl-entry" role="listitem">
Schiavina, Marcello, Michele Melchiorri, and Martino Pesaresi. 2023. <span>“GHS-SMOD R2023A - GHS Settlement Layers, Application of the Degree of Urbanisation Methodology (Stage I) to GHS-POP R2023A and GHS-BUILT-S R2023A, Multitemporal (1975-2030).”</span> European Commission, Joint Research Centre (JRC). <a href="https://doi.org/10.2905/A0DF7A6F-49DE-46EA-9BDE-563437A6E2BA">https://doi.org/10.2905/A0DF7A6F-49DE-46EA-9BDE-563437A6E2BA</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./gridEZ_tutorial1.html" class="pagination-link" aria-label="Tutorial 1: detailed gridEZ example">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Tutorial 1: detailed gridEZ example</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./gridEZ_tutorial3.html" class="pagination-link" aria-label="Tutorial 3: alternative sampling frame stratification example">
        <span class="nav-page-text">Tutorial 3: alternative sampling frame stratification example</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>